!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="5854b35f-168c-452f-90f9-f26317e1cdb6",e._sentryDebugIdIdentifier="sentry-dbid-5854b35f-168c-452f-90f9-f26317e1cdb6")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2549],{61187:function(e,t,n){var o={".":7138,"./":7138,"./arquero":29391,"./arquero.js":29391,"./arrow":57938,"./arrow.js":57938,"./dependencies":67363,"./dependencies.js":67363,"./dependency":10170,"./dependency.js":10170,"./dom":81820,"./dom/":81820,"./dom/canvas":76342,"./dom/canvas.js":76342,"./dom/context2d":99733,"./dom/context2d.js":99733,"./dom/download":32938,"./dom/download.js":32938,"./dom/element":63380,"./dom/element.js":63380,"./dom/index":81820,"./dom/index.js":81820,"./dom/input":37585,"./dom/input.js":37585,"./dom/range":57170,"./dom/range.js":57170,"./dom/select":31106,"./dom/select.js":31106,"./dom/svg":55895,"./dom/svg.js":55895,"./dom/text":30281,"./dom/text.js":30281,"./dom/uid":81831,"./dom/uid.js":81831,"./duckdb":93874,"./duckdb.js":93874,"./fileAttachment":12149,"./fileAttachment.js":12149,"./files":46155,"./files/":46155,"./files/buffer":43825,"./files/buffer.js":43825,"./files/index":46155,"./files/index.js":46155,"./files/text":9974,"./files/text.js":9974,"./files/url":12174,"./files/url.js":12174,"./generators":26785,"./generators/":26785,"./generators/disposable":12238,"./generators/disposable.js":12238,"./generators/filter":7254,"./generators/filter.js":7254,"./generators/index":26785,"./generators/index.js":26785,"./generators/input":28044,"./generators/input.js":28044,"./generators/map":33921,"./generators/map.js":33921,"./generators/observe":61367,"./generators/observe.js":61367,"./generators/queue":49042,"./generators/queue.js":49042,"./generators/range":52707,"./generators/range.js":52707,"./generators/valueAt":15890,"./generators/valueAt.js":15890,"./generators/worker":8179,"./generators/worker.js":8179,"./html":46566,"./html.js":46566,"./index":7138,"./index.js":7138,"./leaflet":53861,"./leaflet.js":53861,"./library":64739,"./library.js":64739,"./md":21715,"./md.js":21715,"./mermaid":98843,"./mermaid.js":98843,"./mutable":30221,"./mutable.js":30221,"./now":3666,"./now.js":3666,"./promises":15898,"./promises/":15898,"./promises/delay":52984,"./promises/delay.js":52984,"./promises/index":15898,"./promises/index.js":15898,"./promises/tick":22989,"./promises/tick.js":22989,"./promises/when":37782,"./promises/when.js":37782,"./require":19204,"./require.js":19204,"./resolve":95545,"./resolve.js":95545,"./sqlite":64054,"./sqlite.js":64054,"./svg":54745,"./svg.js":54745,"./table":78406,"./table.js":78406,"./template":19225,"./template.js":19225,"./tex":40667,"./tex.js":40667,"./that":5243,"./that.js":5243,"./vegalite":70423,"./vegalite.js":70423,"./width":10282,"./width.js":10282,"./xlsx":40538,"./xlsx.js":40538};function r(e){return Promise.resolve().then(function(){if(!n.o(o,e)){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n(o[e])})}r.keys=function(){return Object.keys(o)},r.id=61187,e.exports=r},64413:function(e,t,n){"use strict";n.d(t,{D:function(){return l},G:function(){return s}});var o=n(59119);let r=new Set(["LineComment","BlockComment"]),i=new Set(["NamedBlockCell","NamedExpressionCell","NamedClassCell","NamedFunctionCell"]);function s(e,t){let n=(0,o.qz)(e);if("Cell"!==n.topNode.type.name)return null;let{firstChild:s}=n.topNode;for(;s&&r.has(s.type.name);)s=s.nextSibling;if(s&&i.has(s.type.name)){let e=s.getChild("VariableDefinition");if(e)return e;let n=s.getChild("QualifiedVariableDefinition");if(n)return t?n:n.getChild("VariableDefinition")}return null}function l(e){let t=(0,o.qz)(e);if("Cell"===t.topNode.type.name&&t.topNode.firstChild&&["NamedBlockCell","NamedExpressionCell"].includes(t.topNode.firstChild.type.name)){let e=t.topNode.firstChild.getChild("Equals");if(null==e?void 0:e.nextSibling)return e.nextSibling}return null}},9231:function(e,t,n){"use strict";var o=n(85893);t.Z=e=>(0,o.jsx)("svg",{width:"8",height:"16",viewBox:"0 0 8 16",fill:"none",...e,children:(0,o.jsx)("path",{d:"M4.74329 10.1741C4.34605 10.6155 3.65395 10.6155 3.25671 10.1741L1.00207 7.66897C0.4229 7.02544 0.879592 6 1.74536 6L6.25464 6C7.12041 6 7.5771 7.02544 6.99793 7.66897L4.74329 10.1741Z",fill:"currentColor"})})},94878:function(e,t,n){"use strict";n.d(t,{FJ:function(){return u},Y2:function(){return i},YG:function(){return a},n4:function(){return s},zL:function(){return l}});var o=n(9337),r=n(57035);class i extends o.i{async process(e){return(await e({type:"request_database_tables",source:this._source,schema:this._schema})).map(e=>({database:null!=e.database?String(e.database):void 0,schema:null!=e.schema?String(e.schema):void 0,table:String(e.name)}))}constructor(e,t){super(),this._source=e,this._schema=t}}class s extends o.i{async process(e){return new Map((await e({type:"request_table_schema",source:this._source,table:(0,r.me)(this._table),mode:this._mode,node_id:this._id,derive:this._derive})).map(e=>{var t,n,o,r;let i=null===(t=this._names)||void 0===t?void 0:t.find(t=>{let{name:n}=t;return n===e.name}),s=null===(n=this._types)||void 0===n?void 0:n.find(t=>{let{name:n}=t;return n===e.name});return[null!==(o=null==i?void 0:i.column)&&void 0!==o?o:e.name,{type:null!==(r=null==s?void 0:s.type)&&void 0!==r?r:e.type,databaseType:e.databaseType,nullable:!1!==e.nullable,name:e.name}]}))}constructor(e,t,n,o,r,i,s){super(),this._source=e,this._table=t,this._mode=n,this._names=o,this._types=r,this._id=i,this._derive=s}}class l extends o.i{async process(e){return await e({type:"request_database_query",source:this._source,operations:this._operations})}constructor(e,t){super(),this._source=e,this._operations=t}}class a extends o.i{async process(e){return await e({type:"request_database_info",source:this._source})}constructor(e){super(),this._source=e}}class u extends o.i{async process(e){return await e({type:"request_data_source_info",source:this._source})}constructor(e){super(),this._source=e}}},89604:function(e,t,n){"use strict";n.d(t,{Nq:function(){return u},pN:function(){return c},vM:function(){return a}});var o=n(27522),r=n(80583),i=n(67294),s=n(94878),l=n(88577);function a(e,t,n){let{isExpanded:o}=(0,r.uF)();return c(t,n,"table",o,e)}function u(e,t){let{isExpanded:n}=(0,o.kR)();return c(e,t,"chart",n)}function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"table",o=!(arguments.length>3)||void 0===arguments[3]||arguments[3],r=arguments.length>4?arguments[4]:void 0,[a,u]=(0,i.useState)(),c=(0,i.useRef)(),d=(0,l.VQ)(e),f="operations"in e?e.operations.from.table:"",p="operations"in e?e.operations.names:void 0,m="operations"in e?e.operations.types:void 0,g="operations"in e?e.operations.derive:void 0;return(0,i.useEffect)(()=>u(void 0),[d,f]),(0,i.useEffect)(()=>{if(!o)return;if(!d||"sql"===n)return u(new Map);let e=new s.n4(d,f,n,p,m,r,g);return c.current=e,e.run(t).then(t=>{e===c.current&&u(t)},t=>{e===c.current&&(console.error("Error fetching table schema: ",t),u(new Map))}),()=>{c.current=void 0}},[d,f,t,n,o,p,m,r,g]),a}},88577:function(e,t,n){"use strict";n.d(t,{M7:function(){return i},Ov:function(){return u},U_:function(){return l},VQ:function(){return r},VS:function(){return p},h8:function(){return c},hS:function(){return f},w4:function(){return s},x2:function(){return d},zO:function(){return a}});var o=n(6032);function r(e){if(!("source"in e))throw Error("missing source");let{source:t}=e;return null===t.name?null:t}function i(e){let t=r(e);if(null===t)throw Error("empty source");return t}function s(e){switch(e){case"sql":return"SQL";case"postgres":return"PostgreSQL";case"sqlite":return"SQLite";case"bigquery":return"BigQuery";case"snowflake":return"Snowflake";case"oracle":return"Oracle";case"mysql":return"MySQL";case"mssql":return"SQL Server";case"duckdb":return"DuckDB";case"csv":return"CSV";case"tsv":return"TSV";case"json":return"JSON";case"arrow":return"Arrow";case"parquet":return"Parquet";case"arquero":return"Arquero";case"databricks":return"Databricks";case"mongosql":return"MongoDB";default:return e}}function l(e,t){return e.name===t.name&&e.type===t.type}function a(e,t){var n,o;return(n=e.name)<(o=t.name)?-1:n>o?1:0}function u(e){return(0,o.yD)(e)?e:c(e)}function c(e){return o.RN.includes(e)?e:"sql"}function d(e){return"".concat(e.type,":").concat(e.name)}function f(e,t){return JSON.stringify([d(e),p(t)])}function p(e){let{database:t,schema:n,table:o}=e;return t?"".concat(t,".").concat(n,".").concat(o):n?"".concat(n,".").concat(o):o}},93202:function(e,t,n){"use strict";n.d(t,{BY:function(){return i},Do:function(){return f},E6:function(){return d},_n:function(){return s},mD:function(){return c}});var o=n(31207);function*r(e){let t=new Map;for(let n of e)for(let e of(0,o.WN)(n))t.set(e,t.has(e)?null:n);for(let n of e)for(let e of(0,o.yL)(n)){let o=t.get(e);o&&(yield[n,o])}}let i=e=>u(e,!1),s=e=>u(e,!0),l=new WeakMap,a=new WeakMap;function u(e,t){let n=t?l:a,o=n.get(e);if(o)return o;let i=new Map;for(let t of e)i.set(t,[]);if(t)for(let[t,n]of r(e))i.get(n).push(t);else for(let[t,n]of r(e))i.get(t).push(n);return n.set(e,i),i}function c(e,t){let n=new Set().add(e);for(let e of n)for(let o of t.get(e))n.add(o);return n.delete(e),n}function d(e){let t=s(e),n=i(e);return new Map(e.map(e=>{let r=n.get(e)||[],i=t.get(e)||[];return[e,{node:e,up:r,down:i,indirectUp:c(e,n),indirectDown:c(e,t),isIsland:!r.length&&!i.length&&!(0,o.q8)(e)}]}))}function f(e,t){return e.node===t.node?"same":t.indirectDown.has(e.node)&&t.indirectUp.has(e.node)?"circular":t.down.includes(e.node)?"direct downstream":t.up.includes(e.node)?"direct upstream":t.indirectDown.has(e.node)?"indirect downstream":t.indirectUp.has(e.node)?"indirect upstream":"none"}},85049:function(e,t,n){"use strict";n.d(t,{KI:function(){return a},Lv:function(){return o},MT:function(){return r},Mv:function(){return l},NQ:function(){return u},Sf:function(){return d},T6:function(){return c},j:function(){return i},l6:function(){return s},re:function(){return f}});let o=64,r=52,i=386,s=280,l=14,a=17,u=25,c=29,d=41,f=20},45215:function(e,t,n){"use strict";function o(e){if(!e)return 0;let t=0;for(let[,n]of e)t+=n.length;return t}function r(e,t){if(!e||!t)return;let{nodeId:n,nodeResultIndex:o}=t,r=o;for(let[t,o]of e){if(n===t)break;r+=o.length}return r}n.d(t,{_:function(){return r},n:function(){return o}})},57035:function(e,t,n){"use strict";n.d(t,{$d:function(){return k},Ec:function(){return y},Je:function(){return N},O$:function(){return b},QI:function(){return u},Tf:function(){return C},V8:function(){return l},Vi:function(){return T},YY:function(){return x},a8:function(){return w},me:function(){return D},nq:function(){return _},t2:function(){return a},xm:function(){return S}});var o=n(7138),r=n(76348),i=n(92227),s=n(88577);let l=Symbol("unhovered");function a(e,t){var n;let o=null==t?void 0:null===(n=t.filter)||void 0===n?void 0:n.map(e=>e.operands.filter(e=>"column"===e.type)[0]);return null==o?void 0:o.find(t=>{let{value:n}=t;return n===e})}function u(e){switch(e){case"number":case"integer":case"bigint":return d;case"date":return f;case"object":return p;case"boolean":return m;case"buffer":return g;default:return c}}function c(e){return"number"==typeof e?d(e):e instanceof Date?f(e):""===e?"<empty string>":"".concat(e)}function d(e){return 0===e?"0":e.toLocaleString("en-US")}function f(e){return(0,i.Z)(e,"Invalid Date")}function p(e){return JSON.stringify(e)}function m(e){return e?"TRUE":"FALSE"}function g(e){return"0x..."}let h=["n","nn"],v=["in","nin"];function y(e){return h.includes(e)}function _(e){return v.includes(e)}function w(e,t){if(void 0!==e&&void 0!==t)switch(e){case"eq":if("string"===t)return"is";return"=";case"ne":if("string"===t)return"is not";return"≠";case"c":return"contains";case"nc":return"does not contain";case"in":return"is in";case"nin":return"is not in";case"lt":if("date"===t)return"is before";return"<";case"gt":if("date"===t)return"is after";return">";case"lte":if("date"===t)return"is on or before";return"≤";case"gte":if("date"===t)return"is on or after";return"≥";case"n":return"is null";case"nn":return"is not null";case"v":return"is valid ".concat(t);case"nv":return"is not valid ".concat(t)}}function S(e){let t;if(!e)return[];let{type:n,nullable:o}=e;switch(n){case"boolean":t=["eq","ne"];break;case"string":t=["eq","ne","c","nc","in","nin"];break;case"number":case"integer":t=["eq","ne","lt","gt","lte","gte","in","nin"];break;case"date":t=["lt","gt","lte","gte"];break;default:return[]}return o?[...t,"n","nn","v","nv"]:t}function b(e,t){if(!(0,o.getTypeValidator)(e)(t))return["v","nv"];switch(e){case"boolean":case"string":return["eq","ne"];case"number":case"integer":case"date":return["lt","lte","gte","gt"];default:return[]}}function k(e,t){return(0,r.Bj)(e)[0].map(e=>e.trim()).map(e=>({type:"primitive",value:(null==t?void 0:t.type)==="number"?+e:e}))}function D(e){return"string"==typeof e?{table:e}:e}function x(e,t){let n=D(e),o=D(t);return(null==n?void 0:n.database)===(null==o?void 0:o.database)&&(null==n?void 0:n.schema)===(null==o?void 0:o.schema)&&(null==n?void 0:n.table)===(null==o?void 0:o.table)}function T(e){return"object"==typeof e?(0,s.VS)(e):e}function C(e,t){return F(e.database,t.database)||F(e.schema,t.schema)||F(e.table,t.table)}function F(e,t){let n=void 0===e,o=void 0===t;return n||o?+o-+n:e<t?-1:e>t?1:0}function N(e){let[t,...n]=e,o="";for(let e of t)o+=e,n.length>0&&(o+="${".concat(JSON.stringify(n.shift()),"}"));return o}},9728:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var o=n(33083),r=n(21482),i=n(31207);function s(e){let t;try{t=(0,i.Hj)(e)}catch(n){if(!(n instanceof SyntaxError))throw n;let{message:e}=n;t=(0,i.Hj)({mode:"js",value:"{throw new SyntaxError(".concat(JSON.stringify(e),");}"),name:null,data:null})}if(null===t.body){let t=new Set,n=new Set,o=new Set,i=new Set;if((0,r.sO)(e)){let{name:o,type:r}=e.data.source;if(o)switch(r){case"database":case"DatabaseClient":t.add(o);break;case"FileAttachment":n.add(o)}}return{type:"empty",databaseClients:t,fileAttachments:n,secrets:o,notificationClients:i}}if("ImportDeclaration"===t.body.type){let{source:e,specifiers:n,injections:o}=t.body,{value:r}=e;return{type:"import",specifier:r,specifiers:n.map(l),injections:null==o?void 0:o.map(l)}}return{...(0,o.hp)(t),type:function(e){let{id:t}=e;switch(null==t?void 0:t.type){case"MutableExpression":return"mutable";case"ViewExpression":return"viewof"}return"normal"}(t),name:(0,i.u2)(e),databaseClients:new Set([...t.databaseClients.keys(),...t.tag?t.tag.databaseClients.keys():[]]),fileAttachments:new Set([...t.fileAttachments.keys(),...t.tag?t.tag.fileAttachments.keys():[]]),secrets:new Set([...t.secrets.keys(),...t.tag?t.tag.secrets.keys():[]]),notificationClients:new Set([...t.notificationClients.keys(),...t.tag?t.tag.notificationClients.keys():[]])}}function l(e){return{imported:e.imported.name,local:e.local.name,mutable:e.mutable,view:e.view}}},93203:function(e,t,n){"use strict";n.d(t,{C2:function(){return s},KV:function(){return a},Yx:function(){return i},jp:function(){return l}});var o=n(61802),r=n(46294);let i=async(e,t,n)=>{let{notebook:{id:i,authors:s},currentUser:l}=e,{authors:a}=t,u=s.map(e=>e.id),c=a.map(e=>e.id);try{await (0,o.Fv)("/document/".concat(i,"/authors"),{authors:a.map(e=>{let{id:t,description:n}=e;return{id:t,description:n}}),removedAuthors:u.filter(e=>!c.includes(e))}),(0,r.MR)((0,r.a$)({type:"notebook:manage:setAuthors",data:{authors:a.length,approved:a.filter(e=>e.approved).length,withDescription:a.filter(e=>e.description).length},eventVersion:1,currentUser:l}))}catch(e){n({type:"showErrorToast",message:"Oops, failed to set authors. Refresh and try again?",key:"setAuthors"})}},s=(e,t)=>{let{authors:n}=t;return{authors:n}},l=async(e,t,n)=>{let{notebook:{id:i,authors:s},currentUser:l}=e,{value:a}=t;try{await (0,o.Fv)("/document/".concat(i,"/author/").concat(a?"accept":"reject")),(0,r.MR)((0,r.a$)({type:"notebook:manage:setAuthorAcceptance",data:{value:a,prevValue:null!==l&&s.some(e=>{let{id:t,approved:n}=e;return t===l.id&&!n})},eventVersion:1,currentUser:l}))}catch(e){n({type:"showErrorToast",message:"Oops, failed to ".concat(a?"accept":"remove"," authorship. Refresh and try again?"),key:"setAuthorAcceptance"})}},a=(e,t)=>{let{authors:n}=e,{currentUser:o,value:r}=t;return r?{authors:n.map(e=>e.id===o.id?{...e,approved:r}:e)}:{authors:n.filter(e=>e.id!==o.id)}}},73545:function(e,t,n){"use strict";n.d(t,{C:function(){return s},Q:function(){return i}});var o=n(11163),r=n.n(o);let i=e=>{let{notebook:{id:t}}=e;r().replace({pathname:"/[at]/[...specifiers]",query:{...r().query,at:"d",specifiers:[t]}})},s=()=>({autosave:!1})},4795:function(e,t,n){"use strict";n.d(t,{h:function(){return r},q:function(){return i}});var o=n(61802);let r=async(e,t,n)=>{let{notebook:{id:r}}=e,{locked:i}=t;try{await (0,o.Fv)("/document/".concat(r,"/commenting-lock"),{locked:i}),n({type:"showSuccessToast",message:"Commenting ".concat(i?"locked":"unlocked","."),key:"commentingLock"})}catch(e){n({type:"showErrorToast",message:"Locking comments failed. Try again?",key:"commentingLock"})}},i=(e,t)=>{let{commentingLock:n}=t;return{commentingLock:n}}},23649:function(e,t,n){"use strict";n.d(t,{A9:function(){return u},E:function(){return v},Fq:function(){return T},I5:function(){return C},Mb:function(){return c},Q8:function(){return p},Sh:function(){return l},Ty:function(){return m},UE:function(){return a},V5:function(){return y},dV:function(){return _},e5:function(){return x},hx:function(){return w},hz:function(){return d},m1:function(){return F},u0:function(){return f},uA:function(){return h}});var o=n(61802),r=n(15784),i=n(8273),s=n(68098);function l(e){let t=new Map;for(let n of D(e)){if(b(n))continue;let e=t.get(n.node_id);e?e.push(n):t.set(n.node_id,[n])}return t}function a(e,t,n){let o=(0,s.Hw)(e),r=n&&(0,s.Hw)(n),l=t&&e.forkOf&&t.id===e.forkOf.owner.id;for(let[n,s]of e.comments){let a=s.filter(t=>t.node_id<=e.saveVersion);a.some(e=>!(0,i.Wg)(e))&&(o||r||l||t&&a.some(e=>e.user.id===t.id))&&e.openComments.add(n)}}let u=(e,t)=>{let{comments:n,composingComments:o,openComments:r}=e,{comments:s}=t;for(let e of(n=new Map(n),D(s))){if(b(e)){for(let[t,s]of n){let l=(s=[...s]).findIndex(t=>!(0,i.tO)(t)&&t.id===e.id);-1!==l&&(s.splice(l,1),n.set(t,s),0===s.length&&r.has(t)&&!o.has(t)&&(r=new Set(r)).delete(t))}continue}if(k(e)){for(let t of n.values()){let o=(t=[...t]).findIndex(t=>!(0,i.tO)(t)&&t.id===e.id);if(-1!==o){let r=t[o];t[o]={...r,update_time:e.update_time,status:e.status},n.set(e.node_id,t)}}continue}let t=[...n.get(e.node_id)||[]],s=t.findIndex(t=>!(0,i.tO)(t)&&t.id===e.id);-1!==s||(t.push(e),t.sort(S),n.set(e.node_id,t),r.has(e.node_id)||(r=new Set(r).add(e.node_id))),(0,i.Wg)(e)&&(t[s]=e,n.set(e.node_id,t))}return{comments:n,openComments:r}},c=(e,t)=>{var n;let{composingComments:o,openComments:r,comments:i}=e,{nodeId:s}=t;return(o=new Set(o)).delete(s),i.has(s)&&(null===(n=i.get(s))||void 0===n?void 0:n.length)!==0||(r=new Set(r)).delete(s),{composingComments:o,openComments:r}},d=(e,t)=>{let{composingComments:n,openComments:o}=e,{nodeId:r}=t;return{composingComments:new Set(n).add(r),openComments:new Set(o).add(r),selectionFocusId:null,selection:new Set}},f=(e,t)=>{let{openComments:n}=e,{nodeId:o}=t;return(n=new Set(n)).delete(o),{openComments:n}},p=(e,t)=>{let{nodeId:n}=t,{expandedResolvedComments:o,openComments:i}=e,s=(0,r.HS)(e,n).length;return o=new Set(o),0===s?o.add(n):o.delete(n),{openComments:new Set(i).add(n),expandedResolvedComments:o}},m=(e,t)=>{let{comments:n}=e,{nodeId:o,status:r,commentId:i}=t,s=[...(n=new Map(n)).get(o)||[]],l=s.findIndex(e=>e.id===i);if(-1!==l){let e=s[l];s[l]={...e,status:r},n.set(o,s)}return{comments:n}},g=0,h=(e,t)=>{let{comments:n}=e,{nodeId:o,content:r,commentId:i}=t,s=[...(n=new Map(n)).get(o)||[]],l=s.findIndex(e=>e.id===i),a=s[l];return s[l]={...a,id:i,status:"updatePending",content:r},n.set(o,s),{comments:n}},v=(e,t)=>{var n;let{comments:o,composingComments:r,openComments:i}=e,{nodeId:s,content:l,currentUser:a}=t,u=[...(o=new Map(o)).get(s)||[]];return u.push({status:"local",create_time:new Date,update_time:null,content:l,node_id:s,nonce:++g,user:a}),o.set(s,u),(r=new Set(r)).delete(s),o.has(s)&&(null===(n=o.get(s))||void 0===n?void 0:n.length)!==0||(i=new Set(i)).delete(s),{composingComments:r,openComments:i,comments:o}},y=(e,t)=>{let{comments:n}=e,{nonce:o,id:r,createTime:s,updateTime:l}=t;for(let[e,t]of n=new Map(n))for(let a=t.length-1;a>=0;a--){let u=t[a];if((0,i.tO)(u)&&u.nonce===o)return(t=[...t])[a]={status:"unresolved",id:r,content:u.content,node_id:u.node_id,create_time:s,update_time:l,user:u.user,resolved:!1},n.set(e,t),{comments:n}}},_=(e,t)=>{let{comments:n}=e,{comment:o}=t,r=[...(n=new Map(n)).get(o.node_id)];if((0,i.tO)(o))r=r.filter(e=>(0,i.tO)(e)&&e.nonce!==o.nonce);else for(let e=0;e<r.length;e++){let t=r[e];(0,i.tO)(t)||t.id!==o.id||(r[e]={...t,status:"deletePending"})}return n.set(o.node_id,r),{comments:n}},w=(e,t)=>{let{comments:n,composingComments:o,openComments:r}=e,{ids:s}=t;for(let[e,t]of n=new Map(n)){for(let e of(t=[...t],s)){let n=t.findIndex(t=>!(0,i.tO)(t)&&t.id===e);-1!==n&&t.splice(n,1)}n.set(e,t),0===t.length&&r.has(e)&&!o.has(e)&&(r=new Set(r)).delete(e)}return{comments:n,openComments:r}};function S(e,t){return+e.create_time-+t.create_time}function b(e){return e.deleted}function k(e){return!!e.update_time&&!e.resolved}function D(e){return e.map(e=>b(e)?e:k(e)?{...e,status:"unresolved"}:{...e,status:e.resolved?"resolved":"unresolved"})}let x=async(e,t,n)=>{let{comment:{id:r,content:i},anonymous:s,reason:l}=t;try{await (0,o.Fv)("/report",{anonymous:s,reason:l,subject:{type:"document_comment",id:r,content:i}}),n({type:"showSuccessToast",message:"Comment reported."})}catch(e){n({type:"showErrorToast",message:"Comment report failed.",key:"reportAbuse"})}},T=(e,t)=>{let{comments:n,openComments:o}=e,{nodeId:r}=t,s=[...(n=new Map(n)).get(r)||[]].map(e=>(0,i.sH)(e)||(0,i.tO)(e)||(0,i.Wg)(e)?e:{...e,status:"resolvePending"});return n.set(r,s),(o=new Set(o)).delete(r),{comments:n,openComments:o}},C=(e,t)=>{let{comments:n}=e,{ids:o}=t;for(let[e,t]of n=new Map(n)){for(let e of(t=[...t],o)){let n=t.findIndex(t=>!(0,i.tO)(t)&&t.id===e);-1!==n&&(t[n]={...t[n],status:"resolved",resolved:!0})}n.set(e,t)}return{comments:n}},F=(e,t)=>{let{expandedResolvedComments:n}=e,{nodeId:o}=t;return(n=new Set(n)).has(o)?n.delete(o):n.add(o),{expandedResolvedComments:n}}},9906:function(e,t,n){"use strict";n.d(t,{AK:function(){return v},GH:function(){return _},Qf:function(){return h},Tv:function(){return k},Xm:function(){return w},ZG:function(){return m},_E:function(){return g},kc:function(){return b},nD:function(){return S},q5:function(){return p},zX:function(){return y}});var o=n(70055),r=n(88541),i=n(94183),s=n(78010),l=n(93525),a=n(46294),u=n(7384),c=n(31207),d=n(746),f=n(68445);let p=(e,t)=>{let{source:n}=t,{focusId:o,model:{nodes:r}}=e,i=null!==o?o:r[r.length-1].id;return(0,s.$T)(e,{id:i,before:!1,node:{mode:"sql",data:{source:n}},type:"insert"})},m=async(e,t,n)=>{let{db:o}=t;await navigator.clipboard.writeText(function(e){switch(e.type){case"cell":return e.name;case"database":case"DatabaseClient":return"DatabaseClient(".concat(JSON.stringify(e.name),")");case"FileAttachment":if("sqlite"===e.dialect)return"FileAttachment(".concat(JSON.stringify(e.name),").sqlite()");return"FileAttachment(".concat(JSON.stringify(e.name),")")}}(o)),n({type:"showSuccessToast",message:"Copied to clipboard"})},g=(e,t)=>{let{notebook:n,currentUser:o}=e,{source:r}=t;(0,a.MR)((0,a.ym)({type:"notebook:manage:insertDatabase",data:{name:r.name},eventVersion:1,notebook:n,currentUser:o}))},h=(e,t)=>{let{suggestion:n,id:i}=t,a=(0,u.DY)(e.model,i);if(!a)return;let d={},p=a.value,m=e.editorStates.get(i).doc.toString();if(p!==m){p=m;let t=(0,o.v)(e,[{type:"modify_node",node_id:i,new_node_value:m}]);d={...d,...t},e={...e,...t},a=(0,u.DY)(e.model,i)}let g=(0,c.u2)(a);if(!g){g=(0,f.Q)("data",(0,r.e)(e.model.nodes));let t=(0,l.q)(e,{id:i,name:g});d={...d,...t},e={...e,...t}}let h=(0,s.$T)(e,n(g));return d={...d,...h},e={...e,...h},d},v=(e,t)=>{let{provider:n,name:o,mimeType:r}=t;return(0,i.pB)(e,{type:"insertFile",file:{name:"".concat(d.c[n].shorthand,"://").concat(o),mimeType:r,status:"private"}})},y=(e,t)=>{let{notebook:n,currentUser:o}=e,{provider:r,size:i,mimeType:s}=t;(0,a.MR)((0,a.ym)({type:"notebook:manage:cloudFileSnippet",data:{provider:r,size:i,mimeType:s},notebook:n,currentUser:o,eventVersion:1}))},_=(e,t)=>{let{provider:n,path:r,name:s,mimeType:l}=t,{model:a}=e,u=new Set(a.resolutions.filter(e=>"cloud_file"===e.type).map(e=>e.specifier)),c=(0,i.Tw)(u,(0,i.Nw)(s||"".concat(d.c[n].shorthand,"File"))),f=v(e,{type:"cloudFileSnippet",provider:n,mimeType:l,name:c}),p={type:"resolve_dependency",specifier_type:"cloud_file",specifier:"".concat(d.c[n].shorthand,"://").concat(c),new_resolution:r};return{...f,...(0,o.v)({...e,...f},[p])}},w=(e,t)=>{let{notebook:n,currentUser:o}=e,{provider:r,mimeType:i,size:s}=t;(0,a.MR)((0,a.ym)({type:"notebook:manage:insertCloudFile",data:{provider:r,mimeType:i,size:s},eventVersion:1,notebook:n,currentUser:o}))},S=(e,t)=>{let{provider:n,name:r}=t,i="".concat(d.c[n].shorthand,"://").concat(r);if(e.model.resolve("cloud_file",i))return(0,o.v)(e,[{type:"resolve_dependency",specifier_type:"cloud_file",specifier:i,new_resolution:null}])},b=(e,t)=>{let{notebook:n,currentUser:o}=e,{provider:r,size:i,mimeType:s}=t;(0,a.MR)((0,a.ym)({type:"notebook:manage:removeCloudFile",data:{provider:r,size:i,mimeType:s},eventVersion:1,notebook:n,currentUser:o}))},k=(e,t)=>{let{notebook:n,currentUser:o}=e,{provider:r,size:i,mimeType:s}=t;(0,a.MR)((0,a.ym)({type:"notebook:manage:downloadCloudFile",data:{provider:r,size:i,mimeType:s},eventVersion:1,notebook:n,currentUser:o}))}},10721:function(e,t,n){"use strict";n.d(t,{H:function(){return l},d:function(){return s}});var o=n(61802),r=n(71902),i=n(49803);let s=(e,t)=>{let{documentKey:n}=t;return{...e,documentKey:n}},l=async(e,t,n)=>{let{context:{context:s}}=e,{documentId:l,expirationDate:a,firstVersion:u,lastVersion:c}=t;n({type:"showProcessingToast",key:"createDocumentKey",message:'Creating notebook key "'.concat(l,'"…')});let d="".concat(l," ").concat((0,i.mr)(new Date));try{let e=await (0,o.Fv)("/document/".concat(l,"/api-key"),{description:d,expire_time:a,first_version:u,last_version:c});n({type:"showSuccessToast",key:"createDocumentKey",message:"Notebook key created."}),n({type:"createDocumentKeySucceeded",documentId:l,documentKey:e})}catch(e){n({type:"showErrorToast",key:"createDocumentKey",message:e instanceof r.ZP&&400===e.status?"Can't create notebook key with user: ".concat(null==s?void 0:s.name,"}"):"Oops, API key creation failed. Try again?"})}}},332:function(e,t,n){"use strict";n.d(t,{N:function(){return c},O:function(){return d}});var o=n(70055),r=n(68478),i=n(88541),s=n(65258),l=n(64413),a=n(7384),u=n(68445);function c(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,i.e)(e.model.nodes),{editorStates:r,model:s}=e,c=r.get(t),{pinned:d,mode:f,data:p,name:m}=(0,a.DY)(s,t);if("js"===f){let e=(0,l.G)(c,!1);e&&(m=c.sliceDoc(e.from,e.to),o.add(m),m=(0,u.Q)(m.replace(/\d+$/g,""),o),c=c.update({changes:{from:e.from,to:e.to,insert:m}}).state)}else m&&(m=(0,u.Q)(m.replace(/\d+$/g,""),o));return m&&o.add(m),{editorState:c,insertEvent:{type:"insert_node",new_next_node_id:n?t:(0,a.o4)(s,t),new_node_value:"",new_node_pinned:d,new_node_mode:f,new_node_data:p,new_node_name:"js"===f?null:m}}}let d=(e,t)=>{let{id:n,before:i=!1}=t,{editorState:l,insertEvent:a}=c(e,n,i),u=e.model.events.length,d=[a],f=(0,s.cn)(e);f&&d.push(f);let p=(0,o.v)(e,d),m={...e,...p},g=(0,r.N)(m,{changes:[{from:0,to:0,insert:l.doc}],selection:l.selection},u),h={...m,...g},v=(0,s.Aq)(h,u);return{...p,...g,...v}}},98966:function(e,t,n){"use strict";n.d(t,{X:function(){return l},n:function(){return s}});var o=n(42628),r=n(61802),i=n(75406);let s=async(e,t,n)=>{let{notebook:o,currentUser:s}=e,{version:l,autosave:a}=t;try{let{edit_unpublished:e,latest_version:t,...i}=await (0,r.a8)("/document/".concat(o.id,"@").concat(l));n({type:"loadedVersion",body:i,editUnpublished:e,initialLatestVersion:t,currentUser:s,autosave:a})}catch(e){(0,i.S)({error:e,key:"load_".concat(o.id),message:"Unable to load the notebook at the specified version",dispatch:n})}},l=(e,t)=>{let{initialLatestVersion:n}=t;return{...(0,o.R)(e,t),initialLatestVersion:n,autosave:!!t.autosave&&t.body.version>=n,isPausedLoad:!1,documentKey:void 0}}},40808:function(e,t,n){"use strict";n.d(t,{l:function(){return i},v:function(){return r}});var o=n(61802);let r=async(e,t,n)=>{let{notebook:{like:r,id:i},currentUser:s}=e,{trigger:l,source:a}=t;if(!s){n({type:"showModal",modal:"login",modalProps:{loginReason:"like"},trigger:l,source:a});return}n({type:"liked",liked:!r});try{await (0,o.Fv)("/document/".concat(i,"/like"),{like:!r})}catch(e){n({type:"liked",liked:r}),n({type:"showErrorToast",message:r?"Oops, un-liking this notebook failed. Try again?":"Oops, liking this notebook failed. Try again?",key:"like"})}},i=(e,t)=>{let{likes:n}=e,{liked:o}=t;return{like:o,likes:Math.max(n+(o?1:-1),0)}}},62089:function(e,t,n){"use strict";n.d(t,{$H:function(){return s},D$:function(){return u},NF:function(){return l},Q1:function(){return a},gY:function(){return c}});var o=n(61802),r=n(46769);let i="Notification not found in queue",s=(e,t)=>{let{notificationRequests:n,notificationMode:o}=e,{requestId:r,notification:i}=t,{onReject:s}=i;if(void 0===o){s("ignoring notification requests until you manually run a cell");return}if("ignore"===o){s("ignoring notification requests for rest of session");return}return(n=new Map(n)).set(r,i),{notificationRequests:n}},l=(e,t)=>{let{notificationRequests:n}=e,{requestId:o}=t;return(n=new Map(n)).delete(o),{notificationRequests:n}},a=async(e,t)=>{let{notebook:n,currentUser:s}=e,l=s?s.name:"unknown user",{id:a,owner:u,model:{title:c},notificationRequests:d}=n,{requestId:f}=t,p=d.get(f);if(!p){console.error(i);return}let{provider:m,address:g,content:h,onConfirm:v,onReject:y}=p;switch(m){case"email":try{let e=await (0,o.Fv)("/notify/email",{id:a,to:g.split(","),content:h});e.error&&y(e.error),v({ok:!0})}catch(e){y(r.K.COULD_NOT_PREPARE_TO_SEND_EMAIL)}break;case"slack":{let e=await (0,o.a8)("".concat("team"===u.type?"/team/".concat(u.id):"/user","/proxy/token?provider=slackNotifications")),t=await new r.r({address:g,token:e,userName:l,notebookTitle:c,scheduled:!1}).send(h);t.ok?v(t):y(t.error);break}default:y(r.K.UNRECOGNIZED_NOTIFICATION_PROVIDER)}},u=(e,t)=>{let{notificationRequests:n}=e,{requestId:o}=t,r=(n=new Map(n)).get(o);if(!r){console.error(i);return}return r.onReject("you chose not to send the notification"),n.delete(o),{notificationRequests:n}},c=()=>({notificationMode:"ignore"})},21135:function(e,t,n){"use strict";n.d(t,{Ez:function(){return l},GJ:function(){return f},Ge:function(){return u},Gr:function(){return g},LZ:function(){return m},P4:function(){return c},Yd:function(){return d},_O:function(){return p},_k:function(){return i},lx:function(){return s},rE:function(){return a},y3:function(){return r}});var o=n(61802);let r=new Set(["gettingStarted","loadingData","exploringData","reusingCode","collaborating","troubleshooting","links","keyboardShortcuts"]),i=(e,t,n)=>{let{page:o}=e,{pane:r}=t;o.pane!==r&&n({type:"togglePane",pane:r})},s=(e,t)=>{let{pane:n,focusKeyboardShortcuts:o}=t;return e.pane===n?e.guide&&"guide"!==n?{pane:"guide"}:{pane:null}:{pane:n,...o&&{helpArticlesOpen:[],helpPaneSectionsOpen:new Set(["keyboardShortcuts"])}}},l=(e,t,n)=>{let{page:o,decorations:{signpost:r}}=e,{pane:i}=t;o.pane!==i&&r&&r===("help"===i?"help":null)&&n({type:"dismissSignpost",trigger:"Implicit"})},a=e=>e.guide&&"guide"!==e.pane?{pane:"guide"}:{pane:null},u=async(e,t,n)=>{let{notebook:r}=e,{collection:i}=t,{initialCollection:s}=r;(null==s?void 0:s.id)!==i.id&&(s=await (0,o.a8)("/collection/@".concat(i.owner.login,"/").concat(i.slug))),n({type:"openCollectionsSidebar",collection:s})},c=e=>({collectionsSidebarOpen:!e.collectionsSidebarOpen}),d=(e,t)=>({collectionsSidebarOpen:!t.orphaned&&e.collectionsSidebarOpen}),f=(e,t)=>{let{helpPaneSectionsOpen:n}=e,{section:o}=t;return(n=new Set(n)).has(o)?n.delete(o):n.add(o),{helpPaneSectionsOpen:n}},p=()=>({collectionsSidebarOpen:!0}),m=(e,t)=>{let{helpArticlesOpen:n}=e,{article:o,reset:r}=t;return{helpArticlesOpen:r?[o]:n.concat(o)}},g=e=>{let{helpArticlesOpen:t}=e;return{helpArticlesOpen:t.slice(0,-1)}}},39030:function(e,t,n){"use strict";n.d(t,{Dq:function(){return i},SK:function(){return c},W8:function(){return l},Z6:function(){return u},eD:function(){return a},gY:function(){return s}});var o=n(61802),r=n(46294);let i=async(e,t,n)=>{let{notebook:{pausedVersion:r,saveVersion:i,id:s}}=e;try{let e=await (0,o.Fv)("/document/".concat(s,"/pause"),{paused_version:i});if(null===e.paused_version)throw Error("Unexpected null paused_version");n({type:"pauseLiveEditsSuccess",pausedVersion:e.paused_version}),n({type:"showSuccessToast",message:"".concat(r?"Paused version updated to":"Paused live editing at"," v").concat(e.paused_version),key:"pauseResume"})}catch(e){n({type:"showErrorToast",message:"Oops, pausing this notebook failed. Try again?",key:"pauseResume"})}},s=async(e,t,n)=>{let{notebook:{id:r}}=e;try{let e=await (0,o.Fv)("/document/".concat(r,"/pause"),{paused_version:null});if(null!==e.paused_version)throw Error("Unexpected non-null paused_version");n({type:"resumeLiveEditsSuccess"}),n({type:"showSuccessToast",message:"Resumed live editing",key:"pauseResume"})}catch(e){n({type:"showErrorToast",message:"Oops, resuming live edits on this notebook failed. Try again?",key:"pauseResume"})}},l=(e,t)=>{let{pausedVersion:n}=t;return{pausedVersion:n}},a=()=>({pausedVersion:null}),u=(e,t)=>{let{currentUser:n,notebook:o}=e,{pausedVersion:i}=t;(0,r.MR)((0,r.ym)({type:"notebook:manage:pauseUpdate",data:{previousPausedVersion:o.pausedVersion},currentUser:n,eventVersion:1,notebook:{...o,pausedVersion:i}}))},c=e=>{let{currentUser:t,notebook:n}=e;(0,r.MR)((0,r.ym)({type:"notebook:manage:pauseUpdate",data:{previousPausedVersion:n.pausedVersion},currentUser:t,eventVersion:1,notebook:{...n,pausedVersion:null}}))}},27703:function(e,t,n){"use strict";n.d(t,{$R:function(){return l},_$:function(){return u},oc:function(){return s},tR:function(){return a}});var o=n(42628),r=n(61802),i=n(91529);let s=()=>({isReverting:!0}),l=(e,t)=>({...(0,o.R)(e,t),isReverting:!1,saveTime:new Date,autosave:!0}),a=()=>({isReverting:!1}),u=async(e,t,n)=>{let{notebook:{id:o,model:s,isReverting:l},currentUser:a,page:{pane:u}}=e;if(l)return;let{remote:c,version:d}=t;n({type:"showProcessingToast",key:"revert",message:c?"".concat((0,i.Ui)(s)," was reverted to version ").concat(d,"…"):"Reverting ".concat((0,i.Ui)(s)," to version ").concat(d,"…")});try{let{edit_unpublished:e,...l}=c?await (0,r.a8)("/document/".concat(o,"@").concat(t.saveVersion)):await (0,r.Fv)("/document/".concat(o,"/revert"),{version:d});n({type:"revertSucceeded",body:l,editUnpublished:e,currentUser:a}),n({type:"showSuccessToast",key:"revert",message:"".concat((0,i.Ui)(s)," was reverted to version ").concat(d,".")}),"history"===u&&n({type:"dismissPane"})}catch(e){n({type:"revertFailed"}),n({type:"showErrorToast",key:"revert",message:"".concat((0,i.Ui)(s)," ").concat(c?"was":"could not be"," reverted. Please reload").concat(c?"":" or try again",".")})}}},48714:function(e,t,n){"use strict";n.d(t,{$k:function(){return E},Fz:function(){return _},IY:function(){return D},J2:function(){return j},Pp:function(){return C},QB:function(){return T},Rt:function(){return O},YU:function(){return y},gL:function(){return M},hf:function(){return k},lc:function(){return F},oG:function(){return S},sA:function(){return I},sk:function(){return q},tT:function(){return N},wW:function(){return R},zI:function(){return x}});var o=n(78120),r=n(64063),i=n.n(r),s=n(70055),l=n(68478),a=n(65258),u=n(21135),c=n(8761),d=n(45215);function f(e){let{searchTerm:t,content:n,caseInsensitive:o=!1,wholeWord:r=!1}=e;t instanceof RegExp||(r&&(t=t.trim()),o&&(n=n.toLocaleLowerCase(),t=t.toLocaleLowerCase()));let i=[],s=-1;if(t instanceof RegExp){let e;for(;null!==(e=t.exec(n));)i.push({location:e.index,matchedText:e[0],captureGroups:e.slice(1)})}else for(;s<n.length-1;){let e=n.indexOf(t,s+1);if(-1===e||(s=e,r&&(e>0&&/\b/.test(n[e-1])||e+t.length<n.length&&/\b/.test(n[e+t.length]))))break;i.push({location:e,matchedText:n.substr(e,t.length),captureGroups:[]})}return i}function p(e,t){for(let o=0;o<t.length;o++){var n;e=e.replaceAll("$".concat(o+1),null!==(n=t[o])&&void 0!==n?n:"")}return e}function m(e){let{searchTerm:t,regexSearch:n}=e;return n?RegExp(t,"gu"):t}function g(e){let{searchTerm:t,editorState:n,caseSensitiveSearch:o,wholeWordSearch:r}=e,i=n.doc.toString(),s=[],l=[{location:0,matchedText:"\n",captureGroups:[]},...f({content:i,searchTerm:"\n"}),{location:i.length,matchedText:"\n",captureGroups:[]}];for(let e=0;e<l.length-1;e++){let n=l[e].location,a=l[e+1].location-1,u=i.substring(n,a+1);if(u)for(let e of f({content:u,searchTerm:t,caseInsensitive:!o,wholeWord:r})){let t,o;let r=e.matchedText,i=e.location;if(r.length>=28){s.push({beforeText:"",termText:i>0?"…".concat(r.substr(0,26),"…"):"".concat(r.substr(0,27),"…"),afterText:"",matchLength:r.length,captureGroups:e.captureGroups,pos:n+i});continue}let l=u.substr(i,r.length);if(u.length<=28)t=u.substring(0,i),o=u.substring(i+r.length);else{let e=Math.floor(i+r.length/2);if(e-14<=0)t=u.substring(0,i),o="".concat(u.substring(i+r.length,27),"…");else if(e+14>u.length)t="…".concat(u.substring(u.length-28+1,i)),o=u.substring(i+r.length);else{let e=(28-r.length)/2-1,n=Math.floor(e),s=Math.ceil(e);t="…".concat(u.substr(i-n,n)),o="".concat(u.substr(i+r.length,s),"…")}}s.push({beforeText:t,termText:l,afterText:o,matchLength:r.length,captureGroups:e.captureGroups,pos:n+i})}}return s.length?s:void 0}function h(e){let t;let{searchAnchor:n,searchResultsVisible:o,searchResults:r,selectedSearchResult:s,model:a}=e;if(r&&(0,d.n)(r)>0){if(n){let e=!1;e:for(let{id:o}of a.nodes){let i=r.get(o);if(o===n.nodeId){if(e=!0,i){for(let[e,{pos:r}]of i.entries())if(r>=n.position){t={nodeId:o,nodeResultIndex:e};break e}}}else if(e&&i){t={nodeId:o,nodeResultIndex:0};break}}}t||(t=b(r,0)),i()(t,s)&&(t=s)}let{editorStates:u,transactions:f}=e;for(let[e]of u)({editorStates:u,transactions:f}=(0,l.N)({editorStates:u,transactions:f},{effects:[c.YE.of((null==r?void 0:r.get(e))||null),c.j5.of(t||null),c.K5.of(o)]},e));return{...e,editorStates:u,transactions:f,selectedSearchResult:t}}function v(e,t){let n;if(!e.searchTerm)return e;let{editorStates:o,searchTerm:r,caseSensitiveSearch:i,wholeWordSearch:s,regexSearch:l,searchResults:a,model:{nodes:u}}=e;t||(t=Array.from(o.keys()));try{n=m({searchTerm:r,regexSearch:l})}catch(t){return h(e)}let c=new Map;for(let{id:e}of u){let r=o.get(e);if(r){let o=t.includes(e)?g({searchTerm:n,editorState:r,caseSensitiveSearch:i,wholeWordSearch:s}):a.get(e);o&&c.set(e,o)}}return h({...e,searchResults:c})}let y=(e,t)=>{let{nodeIds:n}=t;return v(e,n)},_=(e,t)=>{let n,{searchTerm:o}=t,{editorStates:r,caseSensitiveSearch:i,wholeWordSearch:s,regexSearch:l,model:{nodes:a}}=e;if(!o)return h({...e,searchTerm:"",searchResults:void 0,selectedSearchResult:void 0});try{n=m({searchTerm:o,regexSearch:l})}catch(e){return{searchTerm:o,searchResults:void 0,selectedSearchResult:void 0}}let u=new Map;for(let{id:e}of a){let t=r.get(e);if(t){let o=g({searchTerm:n,editorState:t,caseSensitiveSearch:i,wholeWordSearch:s});o&&u.set(e,o)}}return h({...e,searchTerm:o,searchResults:u})};function w(e,t){var n;if(!t)return;let{searchResults:o}=e,{nodeId:r,nodeResultIndex:i}=t,s=null==o?void 0:null===(n=o.get(r))||void 0===n?void 0:n[i];if(!s)return;let{editorStates:a,transactions:u}=e;for(let[e]of a)({editorStates:a,transactions:u}=(0,l.N)({editorStates:a,transactions:u},{effects:[c.j5.of(t)]},e));return{editorStates:a,transactions:u,selectedSearchResult:t,searchAnchor:{nodeId:r,position:s.pos}}}let S=(e,t)=>{let{selectedSearchResult:n}=t;return w(e,n)};function b(e,t){let n,o;let r=0;for(let[i,s]of e){if(t<r+s.length){n=i,o=t-r;break}r+=s.length}return{nodeId:n,nodeResultIndex:o}}let k=e=>{let{searchResults:t,selectedSearchResult:n}=e;if(!t||!n)return;let o=(0,d.n)(t),r=(0,d._)(t,n);return w(e,b(t,r<o-1?r+1:0))},D=e=>{let{searchResults:t,selectedSearchResult:n}=e;if(!t||!n)return;let o=(0,d.n)(t),r=(0,d._)(t,n);return w(e,b(t,r>0?r-1:o-1))},x=(e,t,n)=>(0,u._k)(e,{type:"showPane",pane:"find"},n),T=(e,t)=>{let{initialSearchTerm:n,anchorNodeId:o,anchorPosition:r=0}=t,i={};return void 0!==o&&(i.searchAnchor={nodeId:o,position:r},i.selectedSearchResult=void 0,e={...e,...i}),(void 0!==o||void 0!==n)&&(i={...i,..._(e,{type:"setSearchTerm",searchTerm:null!=n?n:e.searchTerm})}),i},C=(e,t)=>{let{editorStates:n,transactions:r,searchResultsVisible:i,searchAnchor:s}=e,u="pane"in t&&"find"===t.pane&&!i,d={searchResultsVisible:u,searchAnchor:u?s:void 0};if(u!==i){for(let[e]of n)({editorStates:n,transactions:r}=(0,l.N)({editorStates:n,transactions:r},{effects:[c.K5.of(u)]},e));d={...d,editorStates:n,transactions:r}}if(("dismissPane"===t.type||"find"===t.pane)&&i){let{selectedSearchResult:t,searchResults:n}=e;if(n&&t){let{nodeId:r,nodeResultIndex:i}=t,{pos:s,matchLength:l}=n.get(r)[i];d={...d,...(0,a.$c)({...e,...d},r,o.jT.create([o.jT.range(s,s+l)]))}}else d={...d,...(0,a.VH)(e)}}return("dismissPane"===t.type||"aiassist"===t.pane)&&(d={...d,assistFocusId:null}),d},F=e=>{let{findOptionsInputExpanded:t}=e;return{findOptionsInputExpanded:!t}},N=e=>v({...e,caseSensitiveSearch:!e.caseSensitiveSearch,regexSearch:!1}),M=e=>v({...e,wholeWordSearch:!e.wholeWordSearch,regexSearch:!1}),j=e=>v({...e,regexSearch:!e.regexSearch,caseSensitiveSearch:!1,wholeWordSearch:!1}),I=(e,t)=>{let{replaceTerm:n}=t;return{replaceTerm:n}},q=e=>{let{editorStates:t,transactions:n,selectedSearchResult:o,searchResults:r,replaceTerm:i}=e;if(!o||!r)return;t=new Map(t);let{nodeId:a,nodeResultIndex:u}=o,{pos:c,matchLength:d,captureGroups:f}=r.get(a)[u];return e.regexSearch&&(i=p(i,f)),{editorStates:t,transactions:n}=(0,l.N)({editorStates:t,transactions:n},{changes:[{from:c,to:c+d,insert:i}]},a),(0,s.v)({...e,editorStates:t,transactions:n},[{type:"modify_node",new_node_value:t.get(a).doc.toString(),node_id:a}])},O=(e,t,n)=>{let{notebook:{selectedSearchResult:o,searchResults:r}}=e;if(!o||!r)return;let i=(0,d.n)(r);n({type:"showSuccessToast",message:"Replaced ".concat(i," ").concat(1===i?"occurrence":"occurrences")})},R=e=>{let{editorStates:t,transactions:n,selectedSearchResult:o,searchResults:r,replaceTerm:i}=e;if(!o||!r)return;for(let[o,s]of(t=new Map(t),r))({editorStates:t,transactions:n}=(0,l.N)({editorStates:t,transactions:n},{changes:s.map(t=>{let{pos:n,matchLength:o,captureGroups:r}=t,s=i;if(e.regexSearch)for(let e=0;e<r.length;e++)s=p(s,r);return{from:n,to:n+o,insert:s}})},o));let a=[];for(let e of Array.from(r.keys())){let n=t.get(e).doc.toString();a.push({type:"modify_node",new_node_value:n,node_id:e})}return(0,s.v)({...e,editorStates:t,transactions:n},a)},E=e=>{let{replaceInputExpanded:t}=e;return{replaceInputExpanded:!t}}},34415:function(e,t,n){"use strict";n.d(t,{AG:function(){return y},BP:function(){return C},Fq:function(){return w},Kt:function(){return g},MP:function(){return v},PK:function(){return F},Qs:function(){return V},S2:function(){return A},SU:function(){return q},Sx:function(){return N},TW:function(){return S},Uo:function(){return h},WZ:function(){return x},bO:function(){return j},dZ:function(){return U},fV:function(){return E},q6:function(){return M},qg:function(){return m},sc:function(){return b},v2:function(){return I},vJ:function(){return T},wP:function(){return D},zq:function(){return R}});var o=n(63999),r=n(70055),i=n(68478),s=n(88541),l=n(23649),a=n(332),u=n(42831),c=n(65258),d=n(86171),f=n(93202),p=n(7384);let m=e=>{let t;if(null===e.selectionFocusId){let n=e.model.nodes[0].id;t={selectionFocusId:n,focusState:(0,c.mX)(e.focusStack,n)}}let n={selection:new Set(e.model.nodes.map(e=>e.id)),...t};return{...n,...(0,c.N5)({...e,...n})}},g=(e,t)=>{let{add:n}=t,o=e.selectionFocusId;if(null!==o){let t=(0,p.$g)(e.model,o);if(t>=e.model.nodes.length-1)return;o=e.model.nodes[t+1].id}else o=e.focusStack.length?e.focusStack[e.focusStack.length-1]:e.model.nodes[0].id;return k(e,o,n)},h=(e,t)=>{let{add:n}=t,o=e.selectionFocusId;if(null!==o){let t=(0,p.$g)(e.model,o);if(t<=0)return;o=e.model.nodes[t-1].id}else o=e.focusStack.length?e.focusStack[e.focusStack.length-1]:e.model.nodes[e.model.nodes.length-1].id;return k(e,o,n)},v=e=>_(e,!0),y=e=>_(e);function _(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{selection:n,selectionFocusId:o,model:{nodes:r}}=e;if(null===o)return;let i=(t?f.BY:f._n)(r),s=Array.from((0,f.mD)((0,p.DY)(e.model,o),i),e=>e.id);return{selection:new Set([o,...n,...s])}}let w=e=>{let{focusId:t,selection:n,selectionFocusId:o}=e;return null!==t?k(e,t):n.size>0?{selection:new Set}:null!==o?{selectionFocusId:null}:void 0},S=()=>({selection:new Set,selectionFocusId:null}),b=e=>{let{focusId:t}=e;if(null===t)return;let n={selectionFocusId:null,selection:new Set([t]),focusId:null};return{...n,...(0,c.N5)({...e,...n})}};function k(e,t,n){if(e.selectionFocusId===t)return;let o={...null!==e.assistFocusId?{assistFocusId:t}:void 0,selectionFocusId:t,selection:n&&null!==e.selectionFocusId?new Set(e.selection).add(e.selectionFocusId).add(t):e.selection,focusStack:(0,c.mX)(e.focusStack,t)};return{...o,...(0,c.N5)({...e,...o})}}let D=e=>{if(null!==e.selectionFocusId)return(0,c.Aq)(e,e.selectionFocusId)},x=e=>{let{selection:t,selectionFocusId:n}=e;if(null!==n)return(t=new Set(t)).has(n)?t.delete(n):t.add(n),{selection:t}},T=(e,t)=>{let{model:n,selection:o}=e,{id:r}=t;if((0,p.DY)(n,r))return(o=new Set(o)).has(r)?o.delete(r):o.add(r),{selection:o}},C=e=>{let t=[...U(e)],n=t.filter(t=>!(0,p.DY)(e.model,t).pinned);return(0,r.v)(e,n.length?n.map(e=>({type:"pin_node",node_id:e})):t.map(e=>({type:"unpin_node",node_id:e})))},F=e=>{let t=Array.from(U(e),t=>(0,p.DY)(e.model,t));return(0,r.v)(e,(t.some(d.qU)?t.filter(d.qU):t.filter(e=>!(0,d.qU)(e))).map(d.fb))},N=e=>{let t=Array.from(U(e),e=>({type:"remove_node",node_id:e}));if(t.length<e.model.nodes.length)return(0,r.v)(e,t);let{node_id:n}=t.pop();return t.push({type:"modify_node",node_id:n,new_node_value:""}),{...(0,r.v)({...e,...(0,i.N)(e,{changes:{from:0,to:e.editorStates.get(n).doc.length,insert:""}},n)},t),focusId:n,focusStack:[n],selection:new Set,selectionFocusId:null}},M=(e,t)=>{let{before:n}=t,o=U(e),i=[],l=new Set,u=(0,s.e)(e.model.nodes),d=null;for(let t of o){let{editorState:o,insertEvent:r}=(0,a.N)(e,t,n,u);r.new_node_value=o.doc.toString();let s=e.model.events.length+i.length;i.push(r),t===e.selectionFocusId&&(d=s),e.selection.has(t)&&l.add(s)}return{...(0,r.v)(e,i),selection:l,selectionFocusId:d,focusStack:(0,c.mX)(e.focusStack,d)}},j=e=>{let t=new Set(U(e)),n=(0,r.v)(e,Array.from(t,t=>({type:"modify_node",node_id:t,new_node_value:e.editorStates.get(t).doc.toString()})));for(let o=e.model.history.length,r=n.model.history.length;o<r;++o)t.delete(n.model.history[o].node_id);if(!t.size)return n;let i=new o.Z(n.model);for(let e of(i.history=n.model.history.slice(),t))i.history.push({type:"modify_node",node_id:e,new_node_value:(0,p.DY)(i,e).value});return{...n,model:i}},I=e=>{let t=e.selectionFocusId;if(null!==t&&!(t>e.saveVersion))return(0,l.hz)(e,{nodeId:t})},q=(e,t)=>{let{before:n,inherit:o,mode:i="js"}=t,{model:s,focusStack:l,selectionFocusId:a}=e,u=null===a&&l.length?l[l.length-1]:a,d=n&&null===u?s.nodes[0].id:n||null===u?u:(0,p.o4)(s,u),f=o&&null!==u?(0,p.DY)(s,u):null,m=f?f.mode:i,g=(0,r.v)(e,[{type:"insert_node",new_next_node_id:d,new_node_value:"",new_node_pinned:!f||f.pinned,new_node_mode:m,new_node_data:f?f.data:null,new_node_name:"js"===m?null:""}]);return{...g,...(0,c.Aq)({...e,...g},s.events.length)}};function O(e,t){let n=[],o=U(e),i=e.model.nodes;for(let e=i.length-1;e>=0;--e){let r=i[e].id;o.has(r)&&(n.push({type:"move_node",node_id:r,new_next_node_id:t}),t=r)}return(0,u.Sf)(e,(0,r.v)(e,n),e.selectionFocusId)}let R=e=>{let t=U(e),n=e.model.nodes,o=null;for(let e=n.length-1;e>=0;--e)if(t.has(n[e].id)){o=e<n.length-2?n[e+2].id:null;break}return O(e,o)},E=e=>{let t=U(e),n=e.model.nodes,o=null;if(t.has(n[0].id)){for(let e=1;e<n.length;++e)if(!t.has(n[e].id)){o=n[e].id;break}}else for(let e=1;e<n.length;++e)if(t.has(n[e].id)){o=n[e-1].id;break}return O(e,o)},A=(e,t)=>{let{notebook:n}=e,{clipboardData:o}=t,r=U(n),i=[],s=[];for(let e of n.model.nodes)r.has(e.id)&&(i.push(e),s.push(n.editorStates.get(e.id).doc.toString()));o.setData("text/plain",s.join("\n\n")),o.setData("application/vnd.observablehq+json",JSON.stringify(i))},V=(e,t)=>{var n;let{nodes:o}=t,i=null!==(n=e.selectionFocusId)&&void 0!==n?n:e.model.nodes[0].id,s=[],l=new Set,a=null;for(let t of o){let n=e.model.events.length+s.length;s.push({type:"insert_node",new_next_node_id:i,new_node_value:t.value,new_node_pinned:t.pinned,new_node_mode:t.mode,new_node_data:t.data,new_node_name:t.name}),null===a&&(a=n),l.add(n)}return{...(0,r.v)(e,s),selection:l,selectionFocusId:a,focusStack:(0,c.mX)(e.focusStack,a)}};function U(e){let{selection:t,selectionFocusId:n}=e;return t.size||null===n?t:new Set([n])}},86171:function(e,t,n){"use strict";n.d(t,{fb:function(){return d},pk:function(){return p},qU:function(){return a},r:function(){return u}});var o=n(64063),r=n.n(o),i=n(70055),s=n(88797),l=n(7384);function a(e){var t,n;return!!e&&(null===(n=e.data)||void 0===n?void 0:null===(t=n.display)||void 0===t?void 0:t.mode)!=="none"}let u=(e,t)=>{let{id:n}=t,o=(0,l.DY)(e.model,n);if(o)return p(e,{type:"setDisplay",id:n,display:c(o)})};function c(e){var t,n;let o=null===(t=e.data)||void 0===t?void 0:t.display;return(null==o?void 0:o.mode)==="none"?null!==(n=o.previousDisplay)&&void 0!==n?n:null:{mode:"none",previousDisplay:o}}function d(e){return f(e,c(e))}function f(e,t){let{id:n,data:o}=e;return r()(null==o?void 0:o.display,t)?null:{type:"modify_data",node_id:n,new_node_data:t?{...o,display:t}:(0,s.w)(o)?{...o,display:void 0}:null}}let p=(e,t)=>{let n,{id:o,display:r}=t,s=(0,l.DY)(e.model,o);if(!s)return;let a=f(s,r);if(!a)return;let u=e.editorStates.get(o).doc.toString();return s.value!==u&&(n=(0,i.v)(e,[{type:"modify_node",node_id:o,new_node_value:u}])),{...n,...(0,i.v)({...e,...n},[a])}}},93525:function(e,t,n){"use strict";n.d(t,{q:function(){return u}});var o=n(70055),r=n(68478),i=n(64413),s=n(7384),l=n(21482),a=n(31207);let u=(e,t)=>{let{id:n,name:u,replaceReferences:c}=t,d=(0,s.DY)(e.model,n);if(!d)return;let f=(0,a.u2)(d);if(u===(f||""))return;let{editorStates:p,model:m,transactions:g}=e;return("js"===d.mode?{editorStates:p,model:m,transactions:g}=function(e,t,n){let s=function(e,t,n){let{editorStates:o,transactions:s}=n,l=o.get(e.id),a=(0,i.G)(l,!1);if(a){let n=t?null:(0,i.D)(l),u=null===n?a.to:n.from;return(0,r.N)({editorStates:o,transactions:s},{changes:{from:a.from,to:u,insert:t}},e.id)}return t?(0,r.N)({editorStates:o,transactions:s},{changes:{from:0,to:0,insert:"".concat(t," = ")}},e.id):{editorStates:o,transactions:s}}(e,t,n);return{...s,...(0,o.v)({...n,...s},[{type:"modify_node",node_id:e.id,new_node_value:s.editorStates.get(e.id).doc.toString()}])}}(d,u,e):{editorStates:p,model:m,transactions:g}=function(e,t,n){let r=n.editorStates.get(e.id).doc.toString();return(0,o.v)(n,[...e.value!==r?[{type:"modify_node",node_id:e.id,new_node_value:r}]:[],{type:"modify_name",node_id:e.id,new_node_name:t}])}(d,u,e),c&&f&&u)?function(e,t,n){let{editorStates:i,model:s,transactions:u}=e,c=[];for(let e of s.nodes){let o=i.get(e.id);if(e.value&&o){let s=!1,l=(0,a.Qc)({...e,value:o.doc.toString()});for(let o=l.references.length-1;o>=0;o--){let a=l.references[o];("MutableExpression"===a.type||"ViewExpression"===a.type)&&(a=a.id),a.name===t&&(s=!0,{editorStates:i,transactions:u}=(0,r.N)({editorStates:i,transactions:u},{changes:{from:a.start,to:a.end,insert:n}},e.id))}s&&c.push({type:"modify_node",node_id:e.id,new_node_value:i.get(e.id).doc.toString()})}(0,l.sO)(e)&&"cell"===e.data.source.type&&e.data.source.name===t&&c.push({type:"modify_data",node_id:e.id,new_node_data:{...e.data,source:{...e.data.source,name:n}}})}return{editorStates:i,model:s,transactions:u,...(0,o.v)({...e,editorStates:i,model:s,transactions:u},c)}}({...e,editorStates:p,model:m,transactions:g},f,u):{editorStates:p,model:m,transactions:g}}},89227:function(e,t,n){"use strict";n.d(t,{A:function(){return s},U:function(){return i}});var o=n(61802),r=n(46294);let i=(e,t)=>{let{schedule:n}=t;return{schedule:n}},s=async(e,t,n)=>{let{notebook:{id:i,schedule:s},currentUser:l}=e,{schedule:a}=t;try{await (0,o.Fv)("/document/".concat(i,"/schedule"),{schedule:a}),(0,r.MR)((0,r.a$)({type:"notebook:manage:setSchedule",data:{prevSchedule:s,schedule:a},eventVersion:1,currentUser:l}))}catch(e){n({type:"showErrorToast",message:"Could not set schedule. Refresh and try again?",key:"setSchedule"})}}},54915:function(e,t,n){"use strict";n.d(t,{I8:function(){return a},d1:function(){return d},eY:function(){return c},ns:function(){return u}});var o=n(70055),r=n(68478),i=n(88541),s=n(78010),l=n(46294);let a=(e,t)=>{let n,{apply:l,imports:a,mode:u,label:c,afterId:d=null!==e.focusId?e.focusId:e.focusStack.length?e.focusStack[e.focusStack.length-1]:e.model.nodes[e.model.nodes.length-1].id}=t,f=(0,s.$T)(e,{id:d,before:!1,node:{mode:u},type:"insert"}),p=(e={...e,...f}).focusId;if(l({dispatch:function(e){return n=e},state:e.editorStates.get(p)},{label:c},0,0),void 0!==a){let t=(0,i.e)(e.model.nodes),n=(0,o.v)(e,a.filter(e=>{let[n]=e;return!t.has(n)}).map(e=>{let[t,n]=e;return{type:"insert_node",new_next_node_id:null,new_node_value:"import {".concat(t,'} from "').concat(n,'"'),new_node_pinned:!0,new_node_mode:"js",new_node_data:null,new_node_name:null}}));f={...f,...n},e={...e,...n}}return{...f,...(0,r.N)(e,n,p)}},u=(e,t)=>{let{notebook:n,currentUser:o}=e,{label:r}=t;(0,l.MR)((0,l.ym)({type:"notebook:manage:insertSnippet",data:{label:r},eventVersion:1,notebook:n,currentUser:o}))},c=(e,t)=>{let{notebook:n,currentUser:o}=e,{id:r,source:i}=t;(0,l.MR)((0,l.ym)({type:"notebook:cells:manage:acceptSnippet",data:{cellIds:[r],source:i},eventVersion:1,notebook:n,currentUser:o}))},d=(e,t)=>{let{notebook:n,currentUser:o}=e,{id:r,trigger:i,source:s}=t;(0,l.MR)((0,l.ym)({type:"notebook:cells:manage:requestSnippets",data:{cellIds:[r],trigger:i,source:s},eventVersion:1,notebook:n,currentUser:o}))}},98701:function(e,t,n){"use strict";n.d(t,{M:function(){return i},Q:function(){return s}});var o=n(61802),r=n(91529);let i=async(e,t,n)=>{let{notebook:{id:i,model:s}}=e,{status:l,trigger:a,source:u}=t,c="comments"===l;try{let e=await (0,o.Fv)("/document/".concat(i,"/subscribe"),{status:l});a&&n({type:"showSuccessToast",message:c?'You will now receive emails for comments on "'.concat((0,r.Ui)(s),'".'):'You will no longer receive emails for comments on "'.concat((0,r.Ui)(s),'".')}),n({type:"updateSubscriptionSucceeded",status:e.status,trigger:a,source:u})}catch(e){a&&n({type:"showErrorToast",message:"Oops, subscribing to the notebook comments failed. Try again?",key:"updateSubscription"})}},s=(e,t)=>{let{status:n}=t;return{subscriptionState:n}}},16812:function(e,t,n){"use strict";n.d(t,{$b:function(){return l},BO:function(){return u},G6:function(){return m},Hh:function(){return f},PZ:function(){return g},gd:function(){return p},ky:function(){return a},ls:function(){return d},nK:function(){return c}});var o=n(11163),r=n.n(o),i=n(61802),s=n(15784);let l=()=>({isClosingSuggestion:!0}),a=()=>({isClosingSuggestion:!1}),u=(e,t)=>{let{suggestion:n}=t;return{isClosingSuggestion:!1,suggestionFrom:n}},c=async(e,t,n)=>{let{notebook:o,currentUser:r}=e,{source:s,trigger:l}=t;n({type:"showProcessingToast",message:"Closing suggestion",key:"closeSuggestion"});try{await (0,i.Fv)("/suggestion/".concat(o.suggestionFrom.id,"/close")),n({type:"closeSuggestionSucceeded",suggestion:{...o.suggestionFrom,closer:r,close_time:new Date},source:s,trigger:l}),n({type:"showSuccessToast",message:"Suggestion closed",key:"closeSuggestion"})}catch(e){n({type:"closeSuggestionFailed"}),n({type:"showErrorToast",message:"Oops, closing the suggestion failed. Try again?",key:"closeSuggestion"})}},d=()=>({isSuggesting:!0}),f=()=>({isSuggesting:!1}),p=async(e,t,n)=>{let{notebook:o}=e,{description:l,trigger:a,source:u}=t,c=o.id,d=o.forkOf.id,f={id:o.id,owner:o.owner},p={id:o.forkOf.id,owner:o.forkOf.owner};try{let e={to_id:d,from_title:o.model.title,version:o.model.version,description:l},t=await (0,i.Fv)("/document/".concat(c,"/suggest"),e);n({type:"sendSuggestionSucceeded",base:f,target:p,trigger:a,source:u});let m=(0,s.yY)(t);m!==location.pathname?r().push(m):r().reload()}catch(e){n({type:"sendSuggestionFailed",base:f,target:p,trigger:a,source:u}),n({type:"showErrorToast",message:"Oops, suggesting failed. Try again?"})}},m=async(e,t,n)=>{let{notebook:o}=e;try{let e=await (0,i.Fv)("/suggestion/".concat(o.suggestionFrom.id,"/close-acknowledge"));n({type:"suggestionFromUpdated",updatedSuggestionFrom:e})}catch(e){n({type:"showErrorToast",message:"Oops, acknowledging the suggestion was closed failed. Try again?"})}},g=(e,t)=>{let{updatedSuggestionFrom:n}=t;return{suggestionFrom:n}}},42628:function(e,t,n){"use strict";n.d(t,{R:function(){return i}});var o=n(63999),r=n(42831);function i(e,t){let{body:n,editUnpublished:i,currentUser:s}=t,l=o.Z.of({...e.model,version:Math.max(e.model.version,n.version)}),a=o.Z.of(n),[u]=l.patch(a,l.nodes.concat(a.nodes).map(e=>{let{id:t}=e;return[t,t]}));return a.history=Array(e.model.history.length).concat(u),{model:a,editorStates:(0,r.AV)({...e,model:a},s),saveVersion:n.version,saveSubversion:0,editUnpublished:i,focusId:null,focusStack:[],dragId:null,dropId:void 0,hoverId:null}}},88084:function(e,t,n){"use strict";n.d(t,{D:function(){return ev},$:function(){return ey}});var o=n(93203),r=n(73545),i=n(55148),s=n(45063),l=n(78120),a=n(68478),u=n(74548),c=n(91529),d=n(8273);function f(e,t){let n=new Map;for(let o=0;o<t.length;o++){let{node_ids:r,selections:i,avatar_url:s}=t[o];for(let a=0;a<r.length;a++){let f=r[a],p=i[a];if(null!==f&&p){if(n.has(f)||n.set(f,[]),(0,d.kG)(f,e))continue;let r=e.editorStates.get(f);if(r){let e=r.doc.length;for(let t of p.ranges)t.head>e&&(t.head=e),t.anchor>e&&(t.anchor=e)}n.get(f).push(u._O.of({selection:l.jT.fromJSON(p),avatar:s,name:(0,c.KY)(t[o]),order:o}))}}}for(let{node_ids:t}of e.participants)for(let e of t)null===e||n.has(e)||n.set(e,[u._O.of(null)]);let{editorStates:o,transactions:r}=e;for(let[e,t]of n)o.has(e)&&({transactions:r,editorStates:o}=(0,a.N)({transactions:r,editorStates:o},{effects:t},e));let i=e.spotlightParticipant&&!t.some(t=>t.id===e.spotlightParticipant);return{participants:t,transactions:r,editorStates:o,...i?{spotlightParticipant:null}:{}}}var p=n(18824),m=n(4795),g=n(23649),h=n(45414),v=n(77761),y=n(6194),_=n(67534),w=n(52332),S=n(59554),b=n(9906),k=n(76975),D=n(10721),x=n(70055),T=n(332),C=n(80457),F=n(42831),N=n(94183),M=n(65258);function j(e,t,n,o){let r={editor:0,worker:0,comments:0,display:0,total:0,...e.get(n)};return r.total+=o-r[t],0===r.total?e.delete(n):(r[t]=o,e.set(n,r)),e}var I=n(98966),q=n(40808),O=n(7384),R=n(21482);let E=(e,t)=>{let n,o,r,i,s,{beforeId:u,afterId:c}=t,{focusId:d}=e,f=e.editorStates.get(u),p=e.editorStates.get(c),m=f.doc.toString(),g=p.doc.toString(),h=m.length,v=g.length;h<v||u===d&&!h?(n=u,o=c,r=i=0,s=m):(n=c,o=u,r=i=h,s=g);let y=(0,O.DY)(e.model,n),_=(0,O.DY)(e.model,o);if(!y||!_||y.mode!==_.mode&&(!R.qz[y.mode].convertible||!R.qz[_.mode].convertible)&&(d===u?h:d!==c||v))return;let{transactions:w,editorStates:S}=(0,a.N)(e,{changes:{from:r,to:i,insert:s}},o),b=(0,x.v)({...e,transactions:w,editorStates:S},[{type:"remove_node",node_id:n},{type:"modify_node",node_id:o,new_node_value:S.get(o).doc.toString()},..."js"!==y.mode&&"js"!==_.mode&&y.name&&!_.name?[{type:"modify_name",node_id:o,new_node_name:y.name}]:[]]),k=l.jT.single(h),D=(0,a.N)(b,{selection:k},o);return{...b,...D,...(0,M.Aq)({...e,...b,...D},o)}};var A=n(78010),V=n(62089),U=n(39030),P=n(27703),Y=n(63999),L=n(41389),G=n(88541),$=n(8822),z=n(75594),K=n(60938),B=n(54105);function Q(e,t){if(t.some(e=>"revert"===e.type))throw Error("Revert could not be processed.");let n=[],o=new Set,r=new Set,i=new Set,[s,l]=e.model.merge(t,e=>{(0,L.v)(e,n),(0,L.O)(e,{inserts:o,removes:r,modes:i})});s===e.model&&(s=new Y.Z(s)),s.history=e.model.history.concat(n);let c=t.filter(e=>"modify_node"===e.type||"mode_node"===e.type),f=(0,F.GD)(c);if(!l.size&&!o.size&&!r.size&&!i.size&&!f.size)return{model:s,editorStates:e.editorStates,transactions:e.transactions};let{transactions:p,files:m}=e,g=new Map(e.editorStates),h=new Map(l),v=(0,S._6)();for(let[e,t]of l){if(r.has(t))continue;o.delete(t);let n={effects:[u._O.of(null),B.y.of(t)]};({transactions:p,editorStates:g}=(0,a.N)({transactions:p,editorStates:g},n,e,t))}for(let t of o){let n=(0,O.DY)(s,t);n&&(g.set(t,(0,F.l8)(n,v,m,e.owner,(0,d.os)(e))),f.delete(t))}for(let e of r)g.delete(e),l.has(e)||h.set(e,null),f.delete(e);let y=s.events.slice(t[t.length-1].version+1).filter(e=>"modify_node"===e.type||"mode_node"===e.type),_=(0,F.GD)(y);for(let[e,t]of g){let n=(0,z.VL)(t),o=_.get(e)||[],r=n.length-o.length;r>0&&({transactions:p,editorStates:g}=(0,a.N)({transactions:p,editorStates:g},(0,z.r)(t,n.slice(0,r)),e))}for(let[e,t]of f){let n=g.get(e),o=t.map(e=>e.new_node_value);({transactions:p,editorStates:g}=(0,a.N)({transactions:p,editorStates:g},(0,z.cK)(n,o),e))}for(let t of(e.model.nodes!==s.nodes&&({editorStates:g,transactions:p}=(0,G.C)({editorStates:g,transactions:p},s.nodes)),i)){let e=(0,O.DY)(s,t);e&&({transactions:p,editorStates:g}=(0,a.N)({transactions:p,editorStates:g},{effects:K.g.of(e)},t))}return{model:s,editorStates:g,transactions:p,...(0,$.a)(e,h)}}function J(e,t){return!(0,d.ws)(e)&&!1===e.editUnpublished&&t.some(e=>"noop"!==e.type)?{editUnpublished:!0}:void 0}var W=n(48714),H=n(34415),Z=n(97635),X=n(86171),ee=n(64413),et=n(31207),en=n(93525),eo=n(89227),er=n(94163),ei=n(54915);function es(e,t){let{id:n,before:o}=t,{selection:{ranges:r},doc:i}=e.editorStates.get(n),s=[];for(let{from:e,to:t}of r)s.push([e,t]);let u=[],c=0;for(let{from:e,to:t}of r)u.push([c,e]),c=t;u.push([c,i.length]);for(let e=u.length-1-+!o;e>=+o;--e){let t=u[e];/^\s*$/.test(i.sliceString(...t))&&(s.push(t),u.splice(e,1))}let d=0,f=-1;for(let e=0;e<u.length;++e){let t=u[e][1]-u[e][0];t>f&&(f=t,d=e)}for(let e=0;e<u.length;++e)e!==d&&s.push(u[e]);let p=u.map(e=>i.sliceString(...e)),{pinned:m,mode:g,data:h}=(0,O.DY)(e.model,n),v=(0,O.o4)(e.model,n),y=[],_=n;for(let t=0;t<p.length;++t){if(t===d)continue;let r=e.model.version+y.push({type:"insert_node",new_next_node_id:t<d?n:v,new_node_value:p[t],new_node_pinned:m,new_node_mode:g,new_node_data:0===p[t].length?function(e){if(null==e?void 0:e.display){let{display:t,...n}=e;return n}return e}(h):h,new_node_name:"js"===g?null:""});(o&&0===t||!o&&t===p.length-1)&&(_=r)}let w={changes:s.map(e=>{let[t,n]=e;return{from:t,to:n}})},{transactions:S,editorStates:b}=(0,a.N)(e,w,n);y.push({type:"modify_node",node_id:n,new_node_value:p[d]});let k=(0,x.v)({...e,transactions:S,editorStates:b},y),D=(0,a.N)(k,{selection:l.jT.single(o?k.editorStates.get(_).doc.length:0)},_);return{...k,...D,...(0,M.Aq)({...e,...k,...D},_)}}var el=n(21390),ea=n(98701),eu=n(16812),ec=n(83108),ed=n(9728);function ef(e,t){let{id:n,line:o,column:r}=t,{model:i}=e,s=(0,O.DY)(i,n),l=(0,ed.Z)(s);return"import"===l.type||"empty"===l.type?{id:n,line:1,column:0}:{id:n,...l.sourcemap.translate({line:o,column:r})}}function ep(e,t){let{id:n,line:o,column:r}=t,{editorStates:i}=e,s=i.get(n);return Math.min(s.doc.line(Math.min(o,s.doc.lines)).from+r,s.doc.length-1)}function em(e,t,n){e.has(t)||e.set(t,new Set),e.get(t).add(n)}var eg=n(15784),eh=n(88027);function ev(e){let{initialNotebook:t,initialCurrentUser:n,initialCollection:o,initialSafe:r=!1,initialAutosave:i=!0,initialPaused:s=!1,initialSpecifier:l}=e,{isCompare:a=!1,saveVersion:u=t.version,baseNotebook:c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=t.version<=eg.Lr&&(0,w.mG)(t)?0:null,f=(0,N.uu)(t.files),p={assist:t.assist,assistFocusId:null,authors:t.authors,autosave:i,caseSensitiveSearch:!1,chatMessages:[],clientState:"closed",collections:t.collections,commentingLock:t.commenting_lock,comments:(0,g.Sh)(t.comments),composingComments:new Set,creator:t.creator,currentUserLiked:t.like,defaultThumbnail:t.default_thumbnail,description:t.description,documentKey:null,dragId:null,dropId:void 0,editorStates:new Map,editUnpublished:t.edit_unpublished,expandedResolvedComments:new Set,files:f,firstPublishedVersion:t.first_public_version,focusId:d,focusStack:null===d?[]:[d],spotlightParticipant:null,forkOf:t.fork_of,forks:t.forks,hasImporters:t.has_importers,heights:new Map,hoverId:null,id:t.id,initialAutosave:i,initialCollection:o,initialLatestVersion:t.latest_version,initialSpecifier:l?new eh.Z(l):null,insertingId:void 0,isClosingSuggestion:!1,isCompare:a,isForking:!1,isFullscreen:!1,isPausedLoad:s,isMerging:!1,isPublishing:!1,isReverting:!1,isSuggesting:!1,isUnpublishing:!1,isUpdatingTrash:!1,like:t.like,likes:t.likes,model:(0,A.kT)(t),notificationRequests:new Map,notificationMode:void 0,openComments:new Set,owner:t.owner,participants:[],pausedVersion:t.paused_version,publishLevel:t.publish_level,publishTime:t.publish_time,publishVersion:t.publish_version,regexSearch:!1,replaceMessage:void 0,replaceTerm:"",roles:t.roles,safe:r,saveSubversion:0,saveTime:t.update_time||new Date,saveVersion:u,schedule:t.schedule,searchResults:void 0,searchResultsVisible:!1,searchTerm:"",selectedSearchResult:void 0,selection:new Set,selectionFocusId:null,sharing:t.sharing,slug:t.slug,subscriptionState:t.subscription||"default",suggestionFrom:t.suggestion_from,suggestionsTo:t.suggestions_to,thumbnail:t.thumbnail,trashed:t.trashed,wholeWordSearch:!1,workerStatus:new Map,workerTasks:new Set},m=t.edits;return(0,S.OJ)(p,n),(0,F.Hp)(p,n,m),(0,g.UE)(p,n,c),p}let ey={assistFocus:(e,t)=>{let{nodeId:n}=t;return{assistFocusId:n}},blur:M.yv,cellHeight:(e,t)=>{let{heights:n}=e,{heights:o}=t;for(let{id:e,height:t,type:r}of(n=new Map(n),o))j(n,r,e,t);return{heights:n}},chatCreateDraft:(e,t)=>{let{chatMessages:n}=e,{message:o}=t,r=[...n.filter(e=>!(e.id===o.id||e.node_id===o.node_id&&(0,i.t8)(e)))];return r.push(o),{chatMessages:r}},chatDelete:(e,t)=>{let{chatMessages:n}=e,{id:o}=t;return{chatMessages:[...n.filter(e=>e.id!==o)]}},chatDeleteDraft:(e,t)=>{let{chatMessages:n}=e,{id:o}=t;return{chatMessages:[...n.filter(e=>e.id!==o)]}},chatFeedback:(e,t)=>{let{chatMessages:n}=e,{id:o,feedback:r}=t;return{chatMessages:[...n.map(e=>o===e.id?{...e,feedback:r}:e)]}},chatSendDraft:(e,t)=>{let{chatMessages:n}=e,{id:o}=t;return{chatMessages:[...n.map(e=>e.id===o&&(0,i.t8)(e)?{...e,status:"unsent",complete:!0}:e)]}},chatSend:(e,t)=>{let{chatMessages:n}=e,{type:o,...r}=t;return{chatMessages:n.concat({id:(0,s.Z)(8),...r,local:!0,complete:!0,status:"unsent"})}},chatSendConfirmed:(e,t)=>{let{chatMessages:n}=e,{id:o,sent_time:r}=t;return{chatMessages:[...n.map(e=>o===e.id?{...e,status:"sent",sent_time:r}:e)]}},chatUsage:(e,t)=>{let{assist:n}=e,{enabled:o,quota_allocated:r,quota_used:i,quota_exhausted:s}=t;return n?{assist:{...n,enabled:o,quota_allocated:r,quota_exhausted:s,quota_used:i}}:{}},chatsReceived:(e,t)=>{let{chatMessages:n}=e,{chats:o}=t,r=[...n.filter(e=>!o.find(t=>t.id===e.id))];return r.push(...o),{chatMessages:r.sort((e,t)=>"sent_time"in e&&"sent_time"in t?+e.sent_time-+t.sent_time:"sent_time"in e?-1:1)}},clientStateChanged:(e,t)=>{let{clientState:n}=t;if("aborted"===e.clientState&&"aborted"!==n)throw Error("Cannot recover an aborted client.");return{clientState:n,...("reopening"===n||"closed"===n||"aborted"===n)&&f({...e,clientState:n},[])}},closeInsertMenu:M.SS,closeSuggestion:eu.$b,closeSuggestionFailed:eu.ky,closeSuggestionSucceeded:eu.BO,cloudFileSnippet:b.AK,collectionsUpdated:p.Yd,commentComposeCancel:g.Mb,commentComposeOpen:g.hz,commentCreated:g.E,commentDeleted:g.dV,commentSaveConfirmed:g.V5,commentingLockSaved:m.q,commentsDeleteConfirmed:g.hx,commentsUpdated:g.A9,commit:A.th,createDocumentKeySucceeded:D.d,currentUserUpdated:(e,t)=>{let{updatedCurrentUser:n}=t,{owner:o}=e,{editorStates:r,transactions:i}=e,s=(0,S._6)(),u=(0,d.wW)(n,o),c=(0,d.CD)(n),f=(0,d.OA)(n),p=(0,w.Yb)(n)&&(0,_.j5)(n,e),m=!n,g=(0,d.Sx)(n),b=(0,d.S1)(n);if(u!==s.prettierOn||c!==s.closeBracketsOn||p!==s.fileUploadsOn||f!==s.spellcheckOn||g!==s.defaultCellMode||m!==s.loginToUpload||b!==s.vimKeys){(0,S.hS)({prettierOn:u,closeBracketsOn:c,fileUploadsOn:p,loginToUpload:m,spellcheckOn:f,defaultCellMode:g,vimKeys:b});let e=[v.C.of({prettierOn:u,closeBracketsOn:c,fileUploadsOn:p,loginToUpload:m,spellcheckOn:f,defaultCellMode:g,vimKeys:b})];for(let[t]of(c!==s.closeBracketsOn&&e.push(h.Hk.closeBrackets.reconfigure(c?h._g:[])),b!==s.vimKeys&&y.R.loaded&&e.push(h.Hk.vimKeys.reconfigure(s.vimKeys?l.Wl.highest(y.R.vim()):[])),r))({editorStates:r,transactions:i}=(0,a.N)({editorStates:r,transactions:i},{effects:e},t));return{editorStates:r,transactions:i}}},descriptionUpdated:k.z,disableAutosave:r.C,dismissPane:W.Pp,dragEnded:e=>{let{dragId:t,dropId:n}=e;return{...void 0!==n&&(0,x.v)(e,[{type:"move_node",node_id:t,new_next_node_id:n}]),dragId:null,dropId:void 0}},dragStarted:(e,t)=>{let{id:n}=t;return{dragId:n}},dragged:(e,t)=>{let{dropId:n}=e,{id:o}=t;return n===o?void 0:{dropId:o}},duplicate:T.O,edit:(e,t)=>{let{editorStates:n}=e,{id:o,state:r}=t;if(n.get(o)===r)return;let i=new Map(n);i.set(o,r);let s=r.field(C.c);return null==s||s.updateFile(o,r.doc.toString()),{editorStates:i}},editCell:(e,t)=>{let{editorStates:n,transactions:o}=e,{selection:r,id:i,text:s}=t,l=(n=new Map(n)).get(i);if(l){let e=r?l.selection.main:{from:0,to:l.doc.length},t=l.update({changes:{from:e.from,to:e.to,insert:s}});({editorStates:n,transactions:o}=(0,a.N)({editorStates:n,transactions:o},t,i))}return{editorStates:n,transactions:o}},enableVimKeys:e=>{if(!y.R.loaded)return;let t=[h.Hk.vimKeys.reconfigure(l.Wl.highest(y.R.vim()))],{editorStates:n,transactions:o}=e;for(let[e]of n)({editorStates:n,transactions:o}=(0,a.N)({editorStates:n,transactions:o},{effects:t},e));return{editorStates:n,transactions:o}},addNotificationRequest:V.$H,enterSafe:()=>({safe:!0}),exitSafe:()=>({safe:!1}),enterFullscreen:()=>({isFullscreen:!0}),exitFullscreen:()=>({isFullscreen:!1}),fileDeleteSucceeded:N.R$,fileMarkedForDeletion:N.GC,fileReplaced:N.YJ,focus:M.T_,focusAfter:M.ib,focusBefore:M.ug,focusDefinition:M.I$,focusError:M.z1,focusFirst:M.s0,focusLast:M.vG,focusUndo:M.zq,hideComments:g.u0,hover:(e,t)=>{let{id:n}=t,{hoverId:o}=e;if(o!==n)return{hoverId:n}},insertAfter:A.BE,insertBefore:A.Vt,insertCloudFile:b.GH,insertDatabase:b.q5,insertFile:N.pB,insertSuggestion:b.Qf,insertSnippet:ei.I8,liked:q.l,loadedVersion:I.X,localFileUploadSucceeded:N.b1,localFilesAttached:N.QT,merge:E,mergeAfter:(e,t)=>{let{id:n}=t,{model:o}=e,r=(0,O.$g)(o,n)+1;if(!(r>=o.nodes.length))return E(e,{type:"merge",beforeId:n,afterId:o.nodes[r].id})},mergeBefore:(e,t)=>{let{id:n}=t,{model:o}=e,r=(0,O.$g)(o,n)-1;if(!(r<0))return E(e,{type:"merge",beforeId:o.nodes[r].id,afterId:n})},moveDown:A.vi,moveUp:A.A1,openInsertMenu:M.L4,pauseLiveEditsSuccess:U.W8,presence:(e,t)=>{let{participants:n}=t;return f(e,n)},relicense:A.XM,remoteFileUpdated:N.zJ,remove:A.Od,removeCloudFile:b.nD,replaceAll:W.wW,replaceCurrent:W.sk,resolveComments:g.Fq,resolveCommentsConfirmed:g.I5,resolveDependencies:(e,t)=>{let{resolutions:n}=t,o=n.map(e=>({type:"resolve_dependency",specifier_type:e.type,specifier:e.specifier,new_resolution:e.value}));return(0,x.v)(e,o)},confirmNotificationRequest:V.NF,rejectNotificationRequest:V.D$,resumeLiveEditsSuccess:U.eD,revertFailed:P.tR,revertRequested:P.oc,revertSucceeded:P.$R,saveConfirmed:(e,t)=>{let n,{saveVersion:o,saveSubversion:r,saveTime:i,edits:s,events:l}=t,{editorStates:u}=e,c=l.filter(e=>"modify_node"===e.type||"mode_node"===e.type);for(let[e,t]of(0,F.GD)(c))if(u.has(e)){let o=u.get(e),r=t.map(e=>e.new_node_value);({transactions:n,editorStates:u}=(0,a.N)({transactions:n,editorStates:u},(0,z.r)(o,r),e))}for(let[e,t]of(0,F.GD)(s))if(u.has(e)){let o=u.get(e);({transactions:n,editorStates:u}=(0,a.N)({transactions:n,editorStates:u},(0,z.b4)(o,Array(t.length),t.length),e))}let d={saveVersion:o,saveSubversion:r,saveTime:i,editorStates:u,transactions:n};return{...d,...J({...e,...d},l)}},saveReceived:(e,t)=>{let{events:n,edits:o,saveVersion:r,saveTime:i,saveSubversion:s}=t,{editorStates:l,transactions:u,model:c,...d}=Q(e,n);for(let[e,t]of(0,F.GD)(o))if(l.has(e)){let n=l.get(e),o=t.map(F.F2);({transactions:u,editorStates:l}=(0,a.N)({transactions:u,editorStates:l},(0,z.b4)(n,o,0),e))}let f={editorStates:l,transactions:u,saveVersion:r,saveTime:i,saveSubversion:s,model:c,...d};return{...f,...J({...e,...f},n)}},selectionAll:H.qg,selectionBlur:H.Fq,selectionClear:H.TW,selectionComment:H.v2,selectionCut:H.Sx,selectionDelete:H.Sx,selectionDuplicate:H.q6,selectionFocusAfter:H.Kt,selectionFocusBefore:H.Uo,selectionUpstream:H.MP,selectionDownstream:H.AG,selectionFocusEnter:H.wP,selectionFocusToggle:H.WZ,selectionHide:H.PK,selectionInsert:H.SU,selectionMoveDown:H.zq,selectionMoveUp:H.fV,selectionPaste:H.Qs,selectionPin:H.BP,selectionPromote:H.sc,selectionRun:H.bO,selectionToggle:H.vJ,sendSuggestion:eu.ls,sendSuggestionFailed:eu.Hh,setAuthorAcceptance:o.KV,setAuthors:o.C2,setDataSource:Z.j,setDataOperations:(e,t)=>{let{id:n,operations:o}=t,r=(0,O.DY)(e.model,n);if(!r||"table"!==r.mode)return;let i=r.data,s=function(e,t){var n,o,r;let i=new Map((null!==(r=null!==(o=t.names)&&void 0!==o?o:e.operations.names)&&void 0!==r?r:[]).map(e=>{let{name:t,column:n}=e;return[t,n]}));if(0===i.size)return t;let s={};if(null===(n=t.select)||void 0===n?void 0:n.columns){let e=t.select.columns.map(e=>{var t;return null!==(t=i.get(e))&&void 0!==t?t:e});s.select={columns:e}}return t.filter&&(s.filter=t.filter.map(e=>({...e,operands:e.operands.map(e=>{if("column"!==e.type)return e;let t=i.get(e.value);return{...e,value:null!=t?t:e.value}})}))),t.sort&&(s.sort=t.sort.map(e=>{var t;return{...e,column:null!==(t=i.get(e.column))&&void 0!==t?t:e.column}})),t.types&&(s.types=t.types.map(e=>{var t;return{...e,name:null!==(t=i.get(e.name))&&void 0!==t?t:e.name}})),{...t,...s}}(i,o),l=(0,x.v)(e,[{type:"modify_data",node_id:n,new_node_data:{...r.data,operations:{select:s.select||i.operations.select,from:s.from||i.operations.from,filter:s.filter||i.operations.filter,sort:s.sort||i.operations.sort,slice:s.slice||i.operations.slice,types:s.types||i.operations.types,names:s.names||i.operations.names,derive:"derive"in s?void 0===s.derive||0===s.derive.length?void 0:s.derive:i.operations.derive}}}]);return{...l,...(0,M.Aq)({...e,...l},n)}},setChartConfig:(e,t)=>{let{id:n,config:o,options:r}=t,i=(0,O.DY)(e.model,n);if(!i||"chart"!==i.mode)return;let s=R.mc.defaultNode.data.config,l=null===o?s:{...i.data.config,...o,options:null===r?s.options:{...i.data.config.options,...r}},a=(0,x.v)(e,[{type:"modify_data",node_id:n,new_node_data:{...i.data,config:function(e){var t;if((null===(t=e.options.color)||void 0===t?void 0:t.legend)===!1)return e;let n=JSON.parse(JSON.stringify(e));return"field"===n.color.type||n.color.reduce?n.options.color?n.options.color.legend=!0:n.options.color={legend:!0}:n.options.color&&(delete n.options.color.legend,Object.keys(n.options.color).length||delete n.options.color),n}(l)}}]);return{...a,...(0,M.Aq)({...e,...a},n)}},setDisplay:X.pk,sharingUpdate:(e,t)=>{let{type:n,...o}=t;return{...o}},openCollectionsSidebar:p._O,setMode:(e,t)=>{var n,o;let r,{id:i,mode:s,value:l}=t,u=e.editorStates.get(i);if(!u)return;let c=u.field(K.C);if(s===c)return;let d=(0,O.DY)(e.model,i),f=e.editorStates.get(i).doc.toString(),p=d.name;if(d.value!==f&&(r=(0,x.v)(e,[{type:"modify_node",node_id:i,new_node_value:f}])),"js"===c){let t=({...e,...r}).editorStates.get(i),n=(0,ee.G)(t,!1);if(n){if((p=t.doc.sliceString(n.from,n.to))&&(0,et.r1)(p)){let n=(0,ee.G)(t,!0),o=(0,ee.D)(t);n&&o&&(r={...r,...(0,a.N)({...e,...r},{changes:{from:n.from,to:o.from,insert:""}},d.id)})}else p=""}else p=""}if("table"===c||"table"===s){let t=({...e,...r}).editorStates.get(i).doc.length;"table"===c?r={...r,...(0,a.N)({...e,...r},{changes:{from:0,to:t,insert:l||""}},i)}:t&&(r={...r,...(0,a.N)({...e,...r},{changes:{from:0,to:t,insert:""}},i)})}else"js"===s&&p&&({...e,...r}).editorStates.get(i).doc.length&&(r={...r,...(0,a.N)({...e,...r},{changes:{from:0,to:0,insert:"".concat(p," = ")}},i)});let m=(null===(o=d.data)||void 0===o?void 0:null===(n=o.display)||void 0===n?void 0:n.mode)==="none"?{display:{mode:"none"}}:null,g=({...e,...r}).editorStates.get(i).doc;return{...r={...r={...r,...(0,x.v)({...e,...r},[{type:"mode_node",node_id:i,new_node_value:g.toString(),new_node_pinned:g.length?d.pinned:R.qz[s].defaultNode.pinned,..."js"===s?{new_node_mode:s,new_node_name:R.xh.defaultNode.name,new_node_data:{...R.xh.defaultNode.data,...m}}:"sql"===s?{new_node_mode:s,new_node_name:null!=p?p:"",new_node_data:{...R.d0.defaultNode.data,..."table"===c&&{source:d.data.source},...m}}:"table"===s?{new_node_mode:s,new_node_name:null!=p?p:"",new_node_value:R.Zu.defaultNode.value,new_node_data:{...R.Zu.defaultNode.data,...m}}:"chart"===s?{new_node_mode:s,new_node_name:null!=p?p:"",new_node_value:R.mc.defaultNode.value,new_node_data:{...R.mc.defaultNode.data,...m}}:{new_node_mode:s,new_node_name:null!=p?p:"",new_node_data:{...R.qz[s].defaultNode.data,...m}}}])},...(0,a.N)({...e,...r},{effects:K.g.of((0,O.DY)({...e,...r}.model,i))},i)},...(0,M.Aq)({...e,...r},i)}},setName:en.q,selectNextSearchResult:W.hf,selectPreviousSearchResult:W.IY,selectSearchResult:W.oG,setReplaceTerm:W.sA,setSearchTerm:W.Fz,setSchedule:eo.U,showComments:g.Q8,showFindPane:W.QB,signatureHelp:er.M9,signatureHelpDismiss:er.hg,splitAfter:(e,t)=>{let{id:n}=t;return es(e,{id:n,before:!1})},splitBefore:(e,t)=>{let{id:n}=t;return es(e,{id:n,before:!0})},spotlight:(e,t)=>{let{id:n}=t;return n&&e.participants.find(e=>e.id===n)?{spotlightParticipant:n}:{spotlightParticipant:null}},sqlDialectUpdated:(e,t)=>{let{id:n,dialect:o}=t;return(0,a.N)(e,{effects:[h.Hk.sql.reconfigure((0,el.i6)({dialect:(0,R.D7)(o)}))]},n)},suggestionFromUpdated:eu.PZ,ignoreNotificationRequests:V.gY,synced:(e,t)=>{let{events:n,edits:o,saveVersion:r,saveSubversion:i,saveTime:s}=t,{editorStates:a,transactions:u,model:c,...p}=Q(e,n);({editorStates:a,transactions:u}=(0,F.R9)({editorStates:a,transactions:u},o));let m={saveVersion:r,saveSubversion:i,...n.length||o.length?{saveTime:s}:null,editorStates:a,transactions:u,model:c,...p};if(m={...m,...f({...e,...m},e.participants)},null===e.focusId&&!(0,d.os)(e)&&(0,w.mG)(e)&&o.length>0){let t=o[0];(e.participants.some(e=>e.self&&e.node_ids.includes(t.node_id))||!e.participants.some(e=>!e.self&&e.node_ids.includes(t.node_id)))&&a.has(t.node_id)&&(m={...m,...(0,M.$c)({...e,...m},t.node_id,l.jT.single(t.value.length))})}return{...m,...J({...e,...m},n)}},title:A.TN,toggleCaseSensitiveSearch:W.tT,toggleDisplay:X.r,togglePane:W.Pp,togglePin:A.aB,toggleRegexSearch:W.J2,toggleResolvedComments:g.m1,toggleWholeWordSearch:W.gL,tierUpdated:(e,t)=>{let{owner:n,roles:o}=e,{id:r,newTier:i}=t;if(n.id===r&&n.tier!==i&&"public"===n.tier)return{roles:o.filter(e=>"readonly"!==e)}},updateComment:g.uA,updateCommentStatus:g.Ty,updateSearchResults:W.YU,updateSubscriptionSucceeded:ea.Q,workerStatus:(e,t)=>{let{workerStatus:n}=e,{displayModes:o,statuses:r,suggestions:i,chartSpecs:s}=t;for(let[e,t]of(n=new Map(n),o)){let o=n.get(e),r=null==o?void 0:o.display;n.set(e,{...o,display:{mode:t,generation:r?r.generation+1:1}})}for(let[e,t]of r){let o=n.get(e);n.set(e,{...o,status:t})}for(let[e,t]of i){let o=n.get(e);n.set(e,{...o,suggestions:t})}for(let[e,t]of s){let o=n.get(e);n.set(e,{...o,chartSpec:t})}return{workerStatus:n}},workerErrors:(e,t)=>{let{errors:n}=t,{editorStates:o,transactions:r,model:i}=e,s=new Map,l=new Map;for(let e of i.nodes){let t=o.get(e.id).field(ec.ei);for(let n of(t.length&&s.set(e.id,new Set),t)){if(n.isJumpToError)continue;let{jumpToError:t}=n;em(l,e.id,n),t&&em(l,e.id,t)}}for(let[t,o]of n){if(l.delete(t),!o)continue;let n="RuntimeError"===o.name?function(e,t,n){let{model:o}=e,r=(0,O.DY)(o,t),i=n.input;if(!i)return{id:t,message:n.message,position:0};let{references:s}=(0,et.Qc)(r),l=s.find(e=>i===(0,et.m8)(e));if(!l)return null;let a={id:t,message:n.message,position:l.start},u=o.nodes.find(e=>(0,et.WN)(e).includes(i));return u&&(a.jumpToError={isJumpToError:!0,id:u.id,position:0}),a}(e,t,o):"SyntaxError"===o.name?function(e,t,n){if(void 0===n.message)return null;let o=/^[\s\S]+\((\d+):(\d+)\)$/m.exec(n.message);if(!o)return null;let r=+o[1],i=+o[2];return{id:t,message:n.message,position:ep(e,{id:t,line:r,column:i})}}(e,t,o):void 0!==o.stack?function(e,t,n){let o,r;let{editorStates:i}=e,s=null,l=n.stack.split("\n");for(let a=l.length-1;a>-1;a--){let u=l[a];if(o=/observablehq-(\d+):(\d+):(\d+)/.exec(u)){if(+o[1]===t){let r=+o[2]-1,i=+o[3]-1;s={id:t,message:n.message,position:ep(e,ef(e,{id:t,line:r,column:i}))}}else{if(!i.has(+o[1]))break;let t=+o[2]-1,n=+o[3]-1;r={isJumpToError:!0,id:+o[1],position:ep(e,ef(e,{id:+o[1],line:t,column:n}))}}}}return s&&{...s,jumpToError:r}}(e,t,o):null;if(!n)continue;em(l,t,n);let{jumpToError:r}=n;r&&em(l,t,r)}for(let[,e]of l)for(let t of e)em(s,t.id,t);for(let[e,t]of s){let n=(0,O.DY)(i,e);!n||(0,R.hN)(n)||({editorStates:o,transactions:r}=(0,a.N)({editorStates:o,transactions:r},{effects:[ec.Cw.of([...t].map(t=>{var n;return{...t,doc:null===(n=o.get(e))||void 0===n?void 0:n.doc}}))]},e))}return{editorStates:o,transactions:r}},workerGoodbye:e=>{let{heights:t}=e;for(let[e,{worker:n}]of t=new Map(t))0!==n&&j(t,"worker",e,0);return{heights:t,workerStatus:new Map}},workerTask:(e,t)=>{let{safe:n,workerTasks:o}=e,{task:r}=t;return n?void r.reject(Error("no worker in safe mode")):(o.add(r),{workerTasks:o})}}}}]);